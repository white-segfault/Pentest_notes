
## Passive Information gathering

#### WHOIS
```shell-session
areaeric@htb[/htb]$ export TARGET="facebook.com" # Assign our target to an environment variable
areaeric@htb[/htb]$ whois $TARGET

C:\htb> whois.exe facebook.com

## Question
Q1/2: Follow Directly from section
```

#### DNS
```
## Nslookup & DIG

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ nslookup $TARGET

areaeric@htb[/htb]$ dig facebook.com @1.1.1.1

areaeric@htb[/htb]$ export TARGET=www.facebook.com
areaeric@htb[/htb]$ nslookup -query=A $TARGET

areaeric@htb[/htb]$ dig a www.facebook.com @1.1.1.1

areaeric@htb[/htb]$ nslookup -query=PTR 31.13.92.36

areaeric@htb[/htb]$ dig -x 31.13.92.36 @1.1.1.1

areaeric@htb[/htb]$ export TARGET="google.com"
areaeric@htb[/htb]$ nslookup -query=ANY $TARGET

areaeric@htb[/htb]$ dig any google.com @8.8.8.8

areaeric@htb[/htb]$ dig any cloudflare.com @8.8.8.8

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ nslookup -query=TXT $TARGET

areaeric@htb[/htb]$ dig txt facebook.com @1.1.1.1

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ nslookup -query=MX $TARGET

areaeric@htb[/htb]$ dig mx facebook.com @1.1.1.1

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ nslookup $TARGET

areaeric@htb[/htb]$ whois 157.240.199.35

## Questions
- Follow exatly from Nslookup & DIG section
```

#### Passive Subdomain Enumeration
```
## VirusTotals
- Go to Virus total website -> input our target domain -> Relations

## Certificates
- Go to websites like crt.sh -> input our target domain

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ curl -s "https://crt.sh/?q=${TARGET}&output=json" | jq -r '.[] | "\(.name_value)\n\(.common_name)"' | sort -u > "${TARGET}_crt.sh.txt"

areaeric@htb[/htb]$ head -n20 facebook.com_crt.sh.txt

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ export PORT="443"
areaeric@htb[/htb]$ openssl s_client -ign_eof 2>/dev/null <<<$'HEAD / HTTP/1.0\r\n\r' -connect "${TARGET}:${PORT}" | openssl x509 -noout -text -in - | grep 'DNS' | sed -e 's|DNS:|\n|g' -e 's|^\*.*||g' | tr -d ',' | sort -u

## Automating Passive Subdomain Enumeration

areaeric@htb[/htb]$ cat sources.txt

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ cat sources.txt | while read source; do theHarvester -d "${TARGET}" -b $source -f "${source}_${TARGET}";done

areaeric@htb[/htb]$ cat *.json | jq -r '.hosts[]' 2>/dev/null | cut -d':' -f 1 | sort -u > "${TARGET}_theHarvester.txt"

areaeric@htb[/htb]$ cat facebook.com_*.txt | sort -u > facebook.com_subdomains_passive.txt
areaeric@htb[/htb]$ cat facebook.com_subdomains_passive.txt | wc -l
```

#### Passive Infrastructure Identification
```
## Netcaft
-> Enter target domain through the site `https://sitereport.netcraft.com`
-> Look for info like Background, Network, Hosting history

## Wayback Machine 
-> Enter target domain through the site http://web.archive.org/
-> Look for info like what they utilised in previous version that is still in use currently and is vulnerable. 

areaeric@htb[/htb]$ waybackurls -dates https://facebook.com > waybackurls.txt
areaeric@htb[/htb]$ cat waybackurls.txt
```

## Active Information Gathering

#### Active Infrastructure Identification
```
## Web Servers

areaeric@htb[/htb]$ curl -I "http://${TARGET}"

areaeric@htb[/htb]$ whatweb -a3 https://www.facebook.com -v

- Use and look at Wappalyzer

areaeric@htb[/htb]$ wafw00f -v https://www.tesla.com

areaeric@htb[/htb]$ aquatone --help

areaeric@htb[/htb]$ cat facebook_aquatone.txt | aquatone -out ./aquatone -screenshot-timeout 1000

## Questions
Q1: curl -I "http://app.inlanefreight.local"
Q2/3: Use open wappalzyer
```

#### Active Subdomain Enumeration
```
## ZoneTransfers

- Enter target domain to zone transfer using the website https://hackertarget.com/zone-transfer/

areaeric@htb[/htb]$ nslookup -type=NS zonetransfer.me
areaeric@htb[/htb]$ nslookup -type=any -query=AXFR zonetransfer.me nsztm1.digi.ninja

## GoBuster
- Pattern found for facebook.com below, named as pattern.txt
lert-api-shv-{GOBUSTER}-sin6
atlas-pp-shv-{GOBUSTER}-sin6

areaeric@htb[/htb]$ export TARGET="facebook.com"
areaeric@htb[/htb]$ export NS="d.ns.facebook.com"
areaeric@htb[/htb]$ export WORDLIST="numbers.txt"
areaeric@htb[/htb]$ gobuster dns -q -r "${NS}" -d "${TARGET}" -w "${WORDLIST}" -p ./patterns.txt -o "gobuster_${TARGET}.txt"

## Questions
Q1. nslookup -type=any -query=AXFR inlanefreight.htb 10.129.253.104

Q2/3/4
nslookup -type=any -query=NS internal.inlanefreight.htb 10.129.253.104
nslookup -type=any -query=AXFR internal.inlanefreight.htb 10.129.253.104

Q5
dig axfr internal.inlanefreight.htb @10.129.253.104 -> 8
dig axfr inlanefreight.htb @10.129.253.104 -> 19
sum = 19 + 8 = 27
```

#### Virtual hosts

```
## Name-based Virtual Hosting

areaeric@htb[/htb]$ curl -s http://192.168.10.10

areaeric@htb[/htb]$ curl -s http://192.168.10.10 -H "Host: randomtarget.com"

Define vhosts= /opt/SecLists/Discovery/DNS/namelist.txt

areaeric@htb[/htb]$ cat ./vhosts | while read vhost;do echo "\n********\nFUZZING: ${vhost}\n********";curl -s -I http://192.168.10.10 -H "HOST: ${vhost}.randomtarget.com" | grep "Content-Length: ";done

areaeric@htb[/htb]$ curl -s http://192.168.10.10 -H "Host: dev-admin.randomtarget.com"

## Automating Virtual Hosts Dicovery

ffuf -w ./vhosts -u http://192.168.10.10 -H "HOST: FUZZ.randomtarget.com" -fs 612

## Questions

curl -s http://www.inlanefreight.htb

Q1/2/3/4/5:
ffuf -w /opt/SecLists/Discovery/DNS/namelist.txt:FUZZ -u http://www.inlanefreight.htb -H "HOST: FUZZ.inlanefreight.htb" -fs 10918
-> ap, app, citrix, customers, dmz
curl -s http://10.129.253.104 -H "Host: ap/app/citrix/customers/dmz.inlanefreight.htb"
```

#### Crawling

```
## ZAP
- Use ZAP spider functionality to gain an overview of attack surface

## FFuF

areaeric@htb[/htb]$ ffuf -recursion -recursion-depth 1 -u http://192.168.10.10/FUZZ -w /opt/useful/SecLists/Discovery/Web-Content/raft-small-directories-lowercase.txt

## Sensitive Information Disclosure

cewl -m5 --lowercase -w wordlist.txt http://192.168.10.10
or
./cewl.rb -m5 --lowercase -w wordlist.txt http://10.129.253.104

areaeric@htb[/htb]$ ffuf -w ./folders.txt:FOLDERS,./wordlist.txt:WORDLIST,./extensions.txt:EXTENSIONS -u http://192.168.10.10/FOLDERS/WORDLISTEXTENSIONS

areaeric@htb[/htb]$ curl http://192.168.10.10/wp-content/secret~
```

## Skills Assessment
```
Q1: whois "githubapp.com" 

Q2: nslookup -query=mx "githubapp.com"

Q3: whatweb -a3 https://i.imgur.com -v

Q4: https://www.virustotal.com/gui/domain/githubapp.com/relations
	-> Used virustotal and looked at all subdomains, found data-triage-reports.githubapp.com
```