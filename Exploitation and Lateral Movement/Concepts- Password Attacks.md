
## Remote Password Attacks
#### Network Services
```
bc= username/username list, enumeration done properly, AD pw policy ok for brute force related things on domain account. 

WinRM
C=bc, winRM open
P=Potential to obtain credential for user/users to further our access.

SSH
C=bc, SSH open
P=Potential to obtain credential for user/users to further our access.

RDP
C=bc, RDP open
P=Potential to obtain credential for user/users to further our access.

SMB
C=bc, SMB open
P=Potential to obtain credential for user/users to further our access.

// Questions
Find the user for the WinRM/SSH/RDP/SMB service and crack their password. Then, when you log in, you will find the flag in a file there. Submit the flag you found as the answer.
- Illustrates how these service indicated can be conducted againt password attacks, if valid username/username file and password list given. 
```

#### Password Mutations
```
bc= username/username list, enumeration done properly, AD pw policy ok for brute force related things on domain account.
Note: Have an appropriate wordlist or password obtained from previous attacks would be beneficial. 

- The idea of password mutation is mutate a password list to perform brute force attack on a given service. 

C=bc, service open and can conduct password attack on (e.g. rdp,ssh..), and passwordlist given to us. 
P=Potential to obtain credential for user/users to further our access.

// Extra
- Don't forget how password list found can be mutated for cracking hashes, this could be another its use, demonstrated in Passwd, Shadow & Opasswd section exercise.
- Another use:
C=passwordlist, hash to crack
P=Potential to obtain credential for user/users to further our access through password cracking. 


//  Questions
Create a mutated wordlist using the files in the ZIP file under "Resources" in the top right corner of this section. Use this wordlist to brute force the password for the user "sam". Once successful, log in with SSH and submit the contents of the flag.txt file as your answer.
-> Demonstrates how with a suitable passwordlist (usually found/obtained previously), we could mutate the password list for an brute force attack. 
```

## Password Reuse / Default Passwords
```
bc= username/username list, enumeration done properly, AD pw policy ok for brute force related things on domain account. 

## Password reuse
- One of the most easy to execute attacks with high reward if success. 
- Something we should seek to do (user repeat password usage, local admin password reuse, service account same password usage...)
- C=bc, have a valid password and username for the user through previous means and is attacking account of the same feature (e.g. mentioned in 3 lines above, it' not necessary but it does increase the likelihood of the success being success as two drastically user usually wouldn't use the same password).
- P=Potential to obtain credential for user/users to further our access.

## Default passwords/Credential stuffing
- Something we should do to, easy to execute with high rewards if success. 
- C=bc, service uses username and password for authentication
- P=Potential to obtain credential for user/users to further our access.

// Questions
Use the user's credentials we found in the previous section and find out the credentials for MySQL. Submit the credentials as the answer. (Format: <username>:<password>).
	-> This question demonstrated the use fo tools like creds given in the section can be used to find default credentials for a large range of service (e.g. mysql here). 
```

## Windows Local Password Attacks
#### Attacking SAM
```
bc=local admin privielge on windows, target have smb service open or GUi access
- Note: PtH would work but need to enable restricted admin mode.
- Dumps hashes of local account user and maybe domain (active directory) accounts. 

## Attacking SAM

C=bc
P=Obtain hash, which could be cracked later.

## Dumping Hashes with Impacket's Secretdump.py

C= Have hash obatined from Attacking SAM
P= Obtain credentials to further access

## Dumping Hashes with Impacket's Secretdump.py

C= Local Admin Credentials of the host
P= Obtain credentials to further access


// Questions
Where is the SAM database located in the Windows registry? (Format: ****\***)
-> Illustrated where SAM is located

RDP to with user "Bob" and password "HTB_@cademy_stdnt!"
Apply the concepts taught in this section to obtain the password to the ITbackdoor user account on the target. Submit the clear-text password as the answer.
	-> Illustated when we have local admin, we could use perform attack on SAM for lateral movement
	
Dump the LSA secrets on the target and discover the credentials stored. Submit the username and password as the answer. (Format: username:password, Case-Sensitive)
	-> Illustrated a different way fo dumping credentials, using crackmapexec for remote dumping, which can be faster. 
```

#### Attacking LSASS
```
bc=local admin privielge, target has powershell or window GUI access

## Dumping LSASS Process Memory

C=bc
P=Obtain files in which hash can be extracted

## Using Pypkatz to extract credential

C= Have hash obatined from Dumping LSASS
P= Obtain hash to be passed/cracked

// Questions
What is the name of the executable file associated with the Local Security Authority Process?
-> Illustrated what runs the local security Authority Process.

RDP to with user "htb-student" and password "HTB_@cademy_stdnt!"
Apply the concepts taught in this section to obtain the password to the Vendor user account on the target. Submit the clear-text password as the answer. (Format: Case sensitive)
-> Illustrated that local admin is required to dump lsass (lsass.exe is a system process), alongside with the need of elevated powershell privilege, but can yield user credentials. 
```

#### Attacking Active Directory & NTDS.dit
```
bc= Appropriate username/username list, enumeration done properly, AD pw policy ok for brute force related things on domain account.


## Dictionary Attacks against AD accounts using CrackMapExec

C= bc
P= Gain domain admin/equally privileged accounts credentials/access

## Caputuring NTDS.dit

C= Local admin credentials/access from domain controller or domain admin privilege on windows active directory environment.
P= Gain Hashes of domain account, preparing for domain compromise

## Cracking Hashes & Gaining Credentials
C= Have NTDS.dit / domain admin equivalent credentials
P= Obtain clear text credentials from hashes

// Questions
What is the name of the file stored on a domain controller that contains the password hashes of all domain accounts? (Format: ****.***)
	-> Illustrates what file stores the password hashes for all the accounts.
	
Submit the NT hash associated with the Administrator user from the example output in the section reading.
	-> Illustrates what an NT hash is. 
	
On an engagement you have gone on several social media sites and found the Inlanefreight employee names: John Marston IT Director, Carol Johnson Financial Controller and Jennifer Stapleton Logistics Manager. You decide to use these names to conduct your password attacks against the target domain controller. Submit John Marston's credentials as the answer. (Format: username:password, Case-Sensitive)
	-> Illustrates that if we are able to locate username of highly privileged employee, we may be able to perform a targed brute force attack. However password policy is unknown here so need to exercise with care (confirm that there is no password lockout policy). Remember Active directory skills II, this actually happened. 

Capture the NTDS.dit file and dump the hashes. Use the techniques taught in this section to crack Jennifer Stapleton's password. Submit her clear-text password as the answer. (Format: Case-Sensitive)
	-> Illustrates how any user's hash can be obtained and potentially crackeded if NTDS is obtained, infact the whole domain is compromised.
```

#### Credential Hunting in Windows
```
bc=Obtained access to an Windows account (have a valid pair of credentials), preferably with access RDP (can rdp).

C=bc
P=Potential to obtain credential for user/users to further our access.

// Questions
What password does Bob use to connect to the Switches via SSH? (Format: Case-Sensitive)

What is the GitLab access code Bob uses? (Format: Case-Sensitive)

What credentials does Bob use with WinSCP to connect to the file server? (Format: username:password, Case-Sensitive)

What is the default password of every newly created Inlanefreight Domain user account? (Format: Case-Sensitive)

What are the credentials to access the Edge-Router? (Format: username:password, Case-Sensitive)

-> The questions aimed to illustrate one point, that is, you can gain access t various kind of credentials once you gain access to it, so becareful when hunting for them.
```

## Linux Local Password Attacks
#### Credential Hunting in Linux
```
bc=Obtained access to an Linux account (have a valid pair of credentials)

## Files

C=bc
P=Obtain useful info

## History

C= bc
P= Obtain useful info

## Memory and Cache

C= bc, suitable privileges for some tools (e.g. Mimipenguin)
P= Obtain useful info

// Questions
Examine the target and find out the password of the user Will. Then, submit the password as the answer.
	-> Illustrated how the pair of credential is sometimes hidden through browser and can be attacked through tools like firefox_decrypt (for firefox example).
```

#### Passwd, Shadow & Opasswd

```
bc= Have access to target, suitable privileges if reading shadow and Opasswd file

## Passwd File / Shadow

C= bc
P= Understand the structure of Passwd/Shadow/Opasswd file given on the system

## Cracking Linux Credentials

C= Have Linux passwd and shadow file
P= Obtain clear-text credentials for further access


Questions:
Examine the target using the credentials from the user Will and find out the password of the "root" user. Then, submit the password as the answer.
-> Illustrate a short attack chain:
	- First need credentials obtained from previous question
	- Then required to look for credentials (hidden files)
	- Then required to crack the hashes through a mutated word list.
-> This demonstrated how mutated password list can also come to play (i.e. in cracking passwords)
```

## Windows lateral movement
#### Pass the Hash (PtH)
```
bc: Have hash to pass, as well as service opened on various target. (rdp will not work if the service doesn't have rdp, winrm will not work if it does not have winrm services enabled)

powershell remoting bc: needs to be local admin or be in PS remote management group. 

## Pass the Hash with Mimikatz (Windows)/
## Pass the Hash with PowerShell Invoke-TheHash (Windows)

C= bc, hash for Invoke-TheHash need local admin privilege
P= Lateral movement on the target user

## Pass the Hash with Impacket (Linux) /
## Pass the Hash with CrackMapExec (Linux) /
## Pass the Hash with evil-winrm (Linux) /
## Pass the Hash with RDP (Linux) /

C= bc, have specfic register value enabled for RDP
P= Lateral movement on the target user


// Questions
Access the target machine using any Pass-the-Hash tool. Submit the contents of the file located at C:\pth.txt.

Try to connect via RDP using the Administrator hash. What is the name of the registry value that must be set to 0 for PTH over RDP to work? Change the registry key value and connect using the hash with RDP. Submit the name of the registry value name as the answer.

Connect via RDP and use Mimikatz located in c:\tools to extract the hashes presented in the current session. What is the NTLM/RC4 hash of David's account?

Using David's hash, perform a Pass the Hash attack to connect to the shared folder \\DC01\david and read the file david.txt.

Using Julio's hash, perform a Pass the Hash attack to connect to the shared folder \\DC01\julio and read the file julio.txt.

Using Julio's hash, perform a Pass the Hash attack, launch a PowerShell console and import Invoke-TheHash to create a reverse shell to the machine you are connected via RDP (the target machine, DC01, can only connect to MS01). Use the tool nc.exe located in c:\tools to listen for the reverse shell. Once connected to the DC01, read the flag in C:\julio\flag.txt.
-> The questions altgether illustrated some of the key components of pass the hash:
	-> Local admin priviliege on the account target -> can gain rce through impacket -> allows us to enable reg key -> enable remote access to GUI is possible. 
	-> Also through impacket, we can enumerate the locate remote access policy through bloodhound/powerview etc.
	
Optional: John is a member of Remote Management Users for MS01. Try to connect to MS01 using john's account hash with impacket. What's the result? What happen if you use evil-winrm?. Mark DONE when finish.

	-> This exercise illustrated how remote management doesn't necessarily mean can use evil-winrm if the service isn't open, it means we can do powershell remote management and likely use Invoke-TheHash Library. However with an local admin privilege, anything local access is possible

	-> Also through playing around in this question, we see that local admin can access to any open service, despite not having permission (e.g. No one has remote desktop permission on this target but as local admins we can all access them, and adding a user with non-local admin privilege does not permission to access).
	-> Illustrates how either to have privileged access (remote desktop, powershell remote management), local admin makes life much easier. 
	-> Similarly with SQL, to have privileged access (e.g. xp_cmdshell), you need to be sql a admin, or we ca start the standard SQL attack. 
	-> One thing to note is that powershell remote management is not winrm allowed, it only means powershell remote management allowed. Winrm and power shell remote management are different things.
```

#### Pass the Ticket (PtT) from Windows
```
bc:Have tickets to pass (generally require local admin privilege to start harvesting tickets)

## Harvesting Kerberos Tickets from Windows

C= local admin privilege
P= Harvest tickets for user for further access

## Pass the Key or OverPass the Hash

C= Have encryption key to pass to the tools, local admin privilege if using Mimikatz
P= Generate TGT, preparing for lateral movement

## Pass the Ticket (PtT)

C= Have tickets to pass
P= Lateral movement on targets

## Mimikatz - PowerShell Remoting with Pass the Ticket /
## Rubeus - PowerShell Remoting with Pass the Ticket

C= Have tickets to pass, powershell remoting (port5985/5986) available on the host
P= Lateral movement on target

Exercise:
RDP to 10.129.187.130 with user "Administrator" and password "AnotherC0mpl3xP4$$"
Connect to the target machine using RDP and the provided creds. Export all tickets present on the computer. How many users TGT did you collect?
	-> Illustrate that if you conduct this attack with local admin privilege (from previous attack), you will have some chance of getting tickets for lateral movement. 

Use john's TGT to perform a Pass the Ticket attack and retrieve the flag from the shared folder \\DC01.inlanefreight.htb\john
	-> Illustrate how passing tickets can grant access to resources specified for that user only. 

Use john's TGT to perform a Pass the Ticket attack and connect to the DC01 using PowerShell Remoting. Read the flag from C:\john\john.txt
	-> IllUstrate How the ticket can even be used to move to a completely different computer for lateral movement. 
```

#### Pass the Ticket (PtT) from Linux
```
Note on privilege: Can always escalate privilege later on, but with Linux we can read the directories, with Windows to dump tickets need local admin. 
- Keytab with -t while ccache file doesn't need, syntax observation.

## Identifying Linux and Active Directory Integration

C= Access to a Linux host
P= Identify whether we are on in an Active directory environment or not

## Finding Keytab Files /
## Finding ccache Files

C= Be on active directory Linux host
P= Find tickets of other users on the host

## Abusing KeyTab Files

C= Have keytab file from other users, as well as read and write privileges on it.
P= Lateral movement/impersonation of the target user, extract hash, cracking the hash. 

## Abusing Keytab ccache

C= Have keytab file from other users and read privileges on it.
P= Lateral movement/impersonation of the target user

## Using Linux Attack Tools with Kerberos
- Skipped for now, not really relevant.


Questions:
Connect to the target machine using SSH to the port TCP/2222 and the provided credentials. Read the flag in David's home directory.

Which group can connect to LINUX01?
	-> This question demonstrated how access to such machine are groups with high privilege, so hints that the attack will work with a greater probability if the user is in a priviliged group.

Look for a keytab file that you have read and write access. Submit the file name as a response.
	-> Illustrates the important of enumerating keytab file.

Extract the hashes from the keytab file you found, crack the password, log in as the user and submit the flag in the user's home directory.
	-> Illustrates cracking hashes from keytab file.

Check Carlos' crontab, and look for keytabs to which Carlos has access. Try to get the credentials of the user svc_workstations and use them to authenticate via SSH. Submit the flag.txt in svc_workstations' home directory.
	-> Illustrates the importance of crontab checking and iterative enumeration, as it can often can have useful information like keytab files.

Check svc_workstation's sudo privileges and get access as root. Submit the flag in /root/flag.txt directory as the response.
	-> Illustrates how sometimes user's like this (work station) can have sudo privileges or that we could perform some privilege escalation ourselves (attack chain).

Check the /tmp directory and find Julio's Kerberos ticket (ccache file). Import the ticket and read the contents of julio.txt from the domain share folder \\DC01\julio.
	-> An illusration of benefits of being root- able to read all the tickets, including the domain admin here and impersonate it for domain compromise.

Use the LINUX01$ Kerberos ticket to read the flag found in \\DC01\linux01. Submit the contents as your response (the flag starts with Us1nG_).
	-> An illustration on how to imperonsate user using keytab instead and what root means when compromising an account. 
```

## Cracking Files
#### Protected Files
```
bc= Have accessed to a target Linux system

## Hunting for Encoded Files

C=bc
P=Potential to obtain confidential information for further access.
- Note that we may encounter different file extension during an engagement and might need to look it up.
- List of useful fileinfo extension: [FileInfo](https://fileinfo.com/filetypes/encoded)

## Cracking with John / Cracking Documents

C= Have encoded file found on the host
P= Remove protection measure made on the file. 


// Questions
Use the cracked password of the user Kira and log in to the host and crack the "id_rsa" SSH key. Then, submit the password for the SSH key as the answer.
	-> Illustrated the cracking of SSH file, gaining some additional information.
```

#### Protected Archives
```
bc= access a linux target host

## Cracking Archives/ZIP

C=bc, have an archive with password protection
P=Potential to obtain confidential information for further access.

## Cracking BitLocker Encrypted Drives

C=bc, have an encrypted vhd to crack
P=Potential to obtain confidential information for further access.

// Questions
Use the cracked password of the user Kira, log in to the host, and read the Notes.zip file containing the flag. Then, submit the flag as the answer.

	-> Illustrated an attack chain (cracked password for user previously -> target suscpeitble to attacks on archive/files).
```

## Skills

#### Password Attacks Lab - Easy
```
Context:
The first host is used for administering and managing other servers within their environment.
	-> Demonstrated how host that is used for administering usually have credentials stored in their history and have valuable stuff to look for.

// Questions
Examine the first target and submit the root password as the answer.

-> Demonstrated the following attack chain:
	-> Brute force attack on ftp to obtain credential (from obtained username and password list previously)
	-> Obtained encrypted ssh keys from ftp service
	-> Decrypted the password of ssh keys through cracking, or it can be done through password reuse.
	-> Logged in to Linux account and hunted for credentials, it the key privielge escalation turned out to be bash history, which can be done using knowledge taught in the section, or in Linux privilege escalation module, history command.

It demonstrated multiple attack paths that could lead to the same result!
```

#### Password Attacks Lab - Medium
```
Context:
Our next host is a workstation used by an employee for their day-to-day work. These types of hosts are often used to exchange files with other employees and are typically administered by administrators over the network. During a meeting with the client, we were informed that many internal users use this host as a jump host. The focus is on securing and protecting files containing sensitive information.
-> Demonstrated hosts like this (work stations) are more likely to be vulnerable to a password attack.

Examine the second target and submit the contents of flag.txt in /root/ as the answer.
	-> Demonstrated an attack chain of 
		- SMB misconfiguration/null session -> exposure of important documentation that can be cracked
		- Iterative process of enumeration (new host new enumeration cycle) and the importance of inner host enumeration (using netstat to check for local service running)
		- Also demonstrated password reuse (ssh and internal sql service have the same password) and password mutation for a word list for SSH key files. 
		- Then through the series of this password misuse vulnerability, more credentials got exposed, which eventually the root credentials (SSH private keys) were being reused on every host!
```

#### Password Attacks Lab - Hard
```
The next host is a Windows-based client. As with the previous assessments, our client would like to make sure that an attacker cannot gain access to any sensitive files in the event of a successful attack. While our colleagues were busy with other hosts on the network, we found out that the user `Johanna` is present on many hosts. However, we have not yet been able to determine the exact purpose or reason for this.
-> Illustrated the fact that if we can access to user that presents on many host (i.e. jump hosts), we can potentially steal credentials.

-> Illustrated an attack chain of:
	-> Brute force attack on jump host that is vulnerable to it
	-> Obtained file vulnerable to cracking (password manager that we have not seen), which led to more credential disclosure.
	-> This furthermore led to the disclosure of an .vhd file, which is prone to cracking as well
	-> After cracking the bitlock, the SAM ad SECURITY were able to be dumped, which shows cases that you dump what you obtain.

The lab illustrated attacks on unfamiliar file extension, something we are likely to face. 
Also the long cracking time indicates the attack of this nature: it takes time to crack and the conditions need to be right (have a word list obtained with mutation applied and correct user used).
```
