
## Initial Enumeration
#### External Recon and Enumeration Principles
```
bc= Access to AD environment network

## Example Enumeration Process

C=bc
P=Obtain information which sets us of for future analysis and attack.

// Questions:
While looking at inlanefreights public records; A flag can be seen. Find the flag and submit it. ( format == HTB{******} )
	-> Illustrates how useful information may be obtained through external recon (in this case, the txt record)
```

#### Initial Enumeration of the Domain
```
bc= Access to AD environment network

## TTPs
C= bc
P= Obtain information which sets us of for future analysis and attack.

## Identifying Users
C= bc
P= Identify users for future attacks (e.g. password attacks)

// Questions
From your scans, what is the "commonName" of host 172.16.5.5?
	-> Illustrates how we could obtain the name of the host through nmap scans.

What host is running "Microsoft SQL Server 2019 15.00.2000.00"? (IP address, not Resolved name)
	-> Illustrates how we can find high target value (potential for attack) through this initial enumeration/scan.
```

## Sniffing out a Foothold

# LLMNR/NBT-NS Poisoning - from Linux
```
bc= Access to AD environment network

## TTPs
C=bc, using Linux to perform the attack.
P=Potential to gain user account and ntlmv2 hashes which may be cracked to obtain credentials to futher our access.

// Questions
Run Responder and obtain a hash for a user account that starts with the letter b. Submit the account name as your answer.
	-> Illustrates how this attack can obtain user account (so even if we can't crack the hash, we know such a user exists)
	
	Crack the hash for the previous account and submit the cleartext password as your answer. 
	-> Illustrates how the ntlmv2 hash can be cracked and obtain clear text credential. Combined with the previous questions, gains us a valid pair of credential we can use.

Run Responder and obtain an NTLMv2 hash for the user wley. Crack the hash using Hashcat and submit the user's password as your answer.
	-> Illustrates how we can get multiple ntlmv2 hash and crack them.
```

#### LLMNR/NBT-NS Poisoning - from Windows
```
bc= Access to AD environment network
## Using Inveigh /
## C# Inveigh (InveighZero)
C=bc, using a Windows machine to perform the attack
P=Potential to gain user account and ntlmv2 hashes which may be cracked to obtain credentials to futher our access.

// Questions
Run Inveigh and capture the NTLMv2 hash for the svc_qualys account. Crack and submit the cleartext password as the answer.
	-> Illustrates how Inveigh has a stronger/different capability then Windows (poisons more service) for this type of poisoning attack, since both accounts here are in the same AD network (i.e. subnets) but Inveigh was able to capture the hash for an user that responder didn't capture and were able to crack it.   
```

## Sighting In, Hunting For a User

#### Password Spraying Overview
```
- not much in this section, but if we were able to pinpoint the user policy somehow, we can make a dedicated user list for password spraying
```

#### Enumerating & Retrieving Password Policies
```
bc= Access to AD environment network

## Enumerating the Password Policy - from Linux - Credentialed
- C=bc, valid credential pair for domain user, using Linux machine for attack
- P=Gain useful info about the password policy which sets us for related future attacks 

## Enumerating the Password Policy - from Linux - SMB NULL Sessions
- C=bc, using Linux machine for attack
- P=Potntial to gain useful info about the password policy which sets us for related future attacks 

## Enumerating Null Session - from Windows
- C=bc, using windows machine for attack
- P=Potential to gain useful info about the password policy which sets us for related future attacks 

## Enumerating the Password Policy - from Linux - LDAP Anonymous Bind
- C=bc, using Linux machine for attack
- P=Potential to gain useful info about the password policy which sets us for related future attacks 

## Enumerating the Password Policy - from Windows
- C=bc, authenticated to a windows machine that is domain
- P=Gain useful info about the password policy which sets us for related future attacks 

// Questions
What is the default Minimum password length when a new domain is created? (One number)
	-> Illustrated the default minimum password length for a new domain

What is the minPwdLength set to in the INLANEFREIGHT.LOCAL domain? (One number)
	-> Illustrates how we can obtain the minimum password length for the domain through enumeration (so password sprays must have at least 8 characters)
```

#### Password Spraying - Making a Target User List
```
bc= Be in an AD network


## SMB NULL Session to Pull User List / 
## Gathering Users with LDAP Anonymous / 
## Enumerating Users with Kerbrute
C=bc, using a linux machine for attack
P=Potential to gain useful info (including password lockout policy) about the username which sets us for related future attacks

Credentialed Enumeration to Build our User List
C=bc, valid credentials for domain user, using a linux machine for attack
P=Gains useful info (including password lockout policy) about the username which sets us for related future attacks

// Questions 
Enumerate valid usernames using Kerbrute and the wordlist located at /opt/jsmith.txt on the ATTACK01 host. How many valid usernames can we enumerate with just this wordlist from an unauthenticated standpoint?
	-> Illustrating how we can enumerate quite a few valid usernames with just this wordlist from an unauthenticated standpoint.
```

## Spray Responsibly

#### Internal Password Spraying - from Linux
```
## Credentialed Enumeration to Build our User List
bc=In a ad environment, using a Linux host for attack, have a valid username list, ad password policy ok (not locking accounts out after spraying)

Internal Password Spraying from a Linux Host
C=bc
P=Potential to gain domain user credentials which may further our access. 

## Local Administrator Password Reuse
C=bc, obtained a local admin hash/password from previous effort.
P=Potential to gain local admin credentials which may further our access.

// Questions
Find the user account starting with the letter "s" that has the password Welcome1. Submit the username as your answer.
-> Illustrates how password spraying can get us domain user accounts. 
```

#### Internal Password Spraying - from Windows
```
bc=Have access to a domain-joined windows host and using it for password spray. 

Note: Tools like DomainPasswordSpray.ps1 will automatically remove users that only has 1 lockout threshold remaining. 

C=bc
P=Potential to gain domain user credentials which may further our access. 

// Questions
Using the examples shown in this section, find a user with the password Winter2022. Submit the username as the answer.
-> Illustrates password spraying on a windows host.
```

## Deeper Down the Rabbit Hole (Further Enumerations)
#### Enumerating Security Controls
```
bc= Be on a windows domained-joined machine, doing machines outside of HTB CPTS job role path.

C=bc
P=Potential to gain information on what security controls present on the windows-domain joined machine, which we can plan for bypassing it. 
```

#### Credentialed Enumeration - from Linux

```
bc=Be in an AD environment, launching attack with Linux machines

## CrackMapExec / ## SMBMap / ## Windapsearch
- C=bc, valid domain user credentials
- P=Gains information about the domain that may be useful for future analysis and helps us plan out our future attacks.

## rpcclient
- C=bc, and valid domain user credentials (if SMB null session doesn't work)
- P=Potential to gains information about the domain that may be useful for future analysis and helps us plan out our future attacks.

## Impacket Toolkit
- C=bc, valid local admin username and password or hash in AD environment
- P=Gets us a reverse shell (system or local admin privilege) that we could enumerate the target or perform other actions with it.

## Bloodhound.py
- C=bc, valid domain user credentials
- P=Gains information about the domain that can used to graph out relationship using BloodHound GUI. It is very likely to reveal many useful information that could help us plan out our attack.

// Questions
What AD User has a RID equal to Decimal 1170?
-> Illustrates how we can use query user by only having the RID of them. 

What is the membercount: of the "Interns" group?
-> Illustrates how we can find out informations like membercount of a specific group (e.g. using bloodhound).

```

#### Credentialed Enumeration - from Windows
```
bc=Authenticated on a windows domain-joined machine and performing the attack using Windows.

## ActiveDirectory PowerShell Module
- C=bc, have the tool imported
- P=Gains information about the domain that may be useful for future analysis and helps us plan out our future attacks.

## PowerView / ## SharpView
- C=bc, have the tool imported
- P=Gains information about the domain that may be useful for future analysis and helps us plan out our future attacks.

## Snaffler
- C=bc, have the tool imported
- P=Potential to extract information about the domain that may be useful for future analysis or contains user credentials for further access.

## BloodHound
- C=bc, Have the tools imported
- P=Gains information about the domain that can used to graph out relationship using BloodHound GUI. It is very likely to reveal many useful information that could help us plan out our attack.

// Questions
Using Bloodhound, determine how many Kerberoastable accounts exist within the INLANEFREIGHT domain. (Submit the number as the answer)
	-> Illustrates how we can use Bloodhound to answer some useful questions like this (Look and planning for Kerberoasting attack)

What PowerView function allows us to test if a user has administrative access to a local or remote host?
	-> Illustrate how powerview can answer important questions like this. Local admin access to a local or remote host is huge (sets up for various password attacks, including but not limited to dumping SAM, LSASS, dumping tickets...)

Run Snaffler and hunt for a readable web config file. What is the name of the user in the connection string within the file?
		-> Illustrate how Snaffler can extract/sniff out important information (in this case, the username in an web config file) from the share that user have access to. For eg., this can help us plan out attacks like brute force later on.

What is the password for the database user?
	-> Combined with the previous question, illustrates how Snaffler can obtained the credential for a likely database host access (Seems to be MySQL admin). This is huge as database usually contains important info that can further our access. 
```

#### Living Off the Land
```
bc=Authenticated on a windows domain-joined machine, performing the attack using Windows and cannot upload tools (e.g. no network access).

## Env Commands For Host & Network Recon / ## Harnessing PowerShell / ## Checking Defenses / ## Am I Alone? / ## Windows Management Instrumentation (WMI) / ## Net Commands / ## Dsquery
- C=bc
- P=Gains information about the domain that may be useful for future analysis and helps us plan out our future attacks.

// Questions
Enumerate the host's security configuration information and provide its AMProductVersion.
	-> Illustrate how we can utilise living of the land tehcnique to find out the host security configuration along with its version, so we can plan to bypass it.

What domain user is explicitly listed as a member of the local Administrators group on the target host?
	-> Illustrate how we can enumerate useful info like this, as local admin access is huge on any target host. It also demonstrated ideas like targetting domain user to obtain local admin access which enables "local password attacks" on the host.

Utilizing techniques learned in this section, find the flag hidden in the description field of a disabled account with administrative privileges. Submit the flag as the answer.
	-> Illustrates the power of LDAP with Dsquery and UAC control, as even with such condition to be searched for, the tool was able to do it. 
```

## Cooking with Fire (Kerberoast attacks)
#### Kerberoasting - from Linux
```
bc=Have sufficient permission in the domain (SYSTEM/ROOT on domain-joined host, have shell in context of domain account, valid domain user credentials in non-domain joined Linux machine, running runas /netonly in non-domain joined windows host)

## Kerberoasting with GetUserSPNs.py
- C=bc
- P=Potential to gain SPN credential (username and/or password) through cracking the hashes obtained from the attack which may further our access.

// Questions
Retrieve the TGS ticket for the SAPService account. Crack the ticket offline and submit the password as your answer.
	-> Illustrated the power of Kerberoasting attack: Being able to obtain the credentials of service accounts. 

What powerful local group on the Domain Controller is the SAPService user a member of?
	-> Combined with the previous question, illustrated how the service account may be privileged (in this case, Account Operators in Domain Controller), which helps further our access (e.g. we may start looking at access in the Domain Controller and seek to compromise it).
```

#### Kerberoasting - from Windows
```
bc= Authenticated to an domain account on windows. 

## Kerberoasting - Semi Manual method
- C=bc
- P=Potential to gain SPN credential (username and/or password) through cracking the hashes obtained from the attack which may further our access.
- Note: The Semi Manual method seeks to illustrate the attack at a lower level, which helps improve our understanding for automated method, which are usually the preferred method during assessment. It is also used as an backup method in case the automated tool failed to work properly.

## Automated / ## Tool Based Route
- C=bc
- P=Potential to gain SPN credential (username and/or password) through cracking the hashes obtained from the attack which may further our - Note: Usually the preferred method during assessment due to its speed. 

A Note on Encryption Types (encryption downgrade Kerberoast attack)
- C=bc, DC has windows version earlier than 2019 and AES encryption is enabled on the service ticket.
- P=Makes cracking password for Kerberoast faster/more efficient, increasing the probaility of success for the Kerberoast attack. 

// Questions
What is the name of the service account with the SPN 'vmware/inlanefreight.local'?
	-> Illustrate how we can retreive SPN during the Kerberoast proces in Windows

Crack the password for this account and submit it as your answer.
	-> Illustrates how the password is cracked for the SPN in the previous question, potentially enabling us to further our access. 
```

## An ACE in the Hole (ACE Attacks)

#### Access Control List (ACL) Abuse Primer
```
- Introduction on ACL's and what they are

// Questions
What type of ACL defines which security principals are granted or denied access to an object? (one word)
	-> Illustrate what type of ACL defines permission for access to an object.

Which ACE entry can be leveraged to perform a targeted Kerberoasting attack?
	-> Illustrate how the GenericAll ACE entry can be leverged to perform a targed Kerberoasting attack. 
```

#### ACL Enumeration
```
bc= Gain Access to AD, preferably have domain user we have controled/owned

## Enumerating ACLs with PowerView
C=bc, tools imported
P=Enumerates ACL's to potentailly abuse it with further attacks.

## Enumerating ACLs with BloodHound
C=bc, bloodhound ingestor runned to collect data & imported to GUI
P=Enumerates ACL's to potentailly abuse it with further attacks.

// Questions
What is the rights GUID for User-Force-Change-Password?
	-> Illustrates how in WIndows, ObjectAceType is not human readable, they are displayed as some numbers instead. 

What flag can we use with PowerView to show us the ObjectAceType in a human-readable format during our enumeration?
	-> Combined with the previous question, illustrates how we can convert/map the GUID value to human readable value using PowerView

What privileges does the user damundsen have over the Help Desk Level 1 group?
	-> Illustrated how the ACL's have a chaining effect of misconfiguration (E.g. The user we control, wley have force password for user damundsen, while damundsen has write privilege (e.g. adding new memebers) to the Help Desk Level 1.

Using the skills learned in this section, enumerate the ActiveDirectoryRights that the user forend has over the user dpayne (Dagmar Payne).
	-> Illustrate how we can enumerate ACL's over an specific user.

What is the ObjectAceType of the first right that the forend user has over the GPO Management group? (two words in the format Word-Word)
	-> Illustrate how we can also enumerate ACL's over GPO's, if we specified it (enumeration of ACL is not limited to user).
```

ACL Abuse Tactics
```
bc= Performed ACL enumeration.

## Abusing ACLs
- C=bc
- P=Potential to gain control of other AD objects (Group, users...) that may furhter our access

## Cleanup
- C=Finished our ACL attack and introduced extra members/configurations for some AD object (e.g. Added a user we control to a group it wasn't initially in)
- P=Clean up the environment for the client, don't leave a mess. 

// Questions
Work through the examples in this section to gain a better understanding of ACL abuse and performing these skills hands-on. Set a fake SPN for the adunn account, Kerberoast the user, and crack the hash using Hashcat. Submit the account's cleartext password as your answer.
	-> Illustration of how a targted Kerberoasting attack is achieved with generic all using a fake SPN. This type of attack is also less invasive for the client. 
```

#### DCSync
```
## validating and performing DCSync
bc= We control the user (e.g. have credential) that has DCSync rights in bloodhound or DS-Replication-Get-Changes-All ACL-rights in PowerView.

- C=bc
- P=Domain Compromise, also supports future tactics like golden ticket for persistence for further (if any) forest compromisie. 

// Questions
Perform a DCSync attack and look for another user with the option "Store password using reversible encryption" set. Submit the username as your answer.
	-> Illustrates how when some user may have clear-text credential and is something to be aware of

What is this user's cleartext password?
	-> Combined with the previous question, illustrates how we couold obtain clear text credential for this specific user if we performed an DCSync attack. 

Perform a DCSync attack and submit the NTLM hash for the khartsfield user as your answer.
	-> Illustrates how we can target a specific user for NTLM hash, this can be useful for something like forging the Golden Ticket by using the NTLM hash of KRBTGT account. 
```

## Stacking the Deck (Common themes in AD)
#### Privileged Access
```
bc= Have a foothold in the domain

## Remote Desktop
- C=BC, RDP (e.g. port 3389 open) enabled on target host
- P=Potential to use RDP, which may help us launch futher attacks

## WinRM
- C=BC, WinRM (e.g. port 5985, 5986 opened) enabled on target host
- P=Potential to use WinRm, which may help us launch futher attacks
Note:
- Users doesn't need to be in remote management group (typically called CanPSRemote in Bloodhound) to use EvilRM, but need them to do PowerShell remote, a subtle difference to note. 

## SQL Server Admin
- C=BC, SQL service (e.g. port 1433 open) enabled on target host
- P=Potential to use SQL database services, which may provide us with various useful info that may help us further our access. 

// Questions
What other user in the domain has CanPSRemote rights to a host?
	-> Illustrates how We can enumerate for PSRemote rights for a specific target using both Bloodhound and PowerView. 

What host can this user access via WinRM? (just the computer name)
	-> Illustrates how we can even have remote access to the domain controller! It shows that taking control of this user will be huge, as various attack can be performed on the DC once we have control this user. 

Leverage SQLAdmin rights to authenticate to the ACADEMY-EA-DB01 host (172.16.5.150). Submit the contents of the flag at C:\Users\damundsen\Desktop\flag.txt.
	-> Illustrates how SQL admin rights allows full control of the database, including xp_cmdshell. This allows us to launch further attacks (e.g. local password attacks of dumping LSA secrets).
```

#### Kerberos "Double Hop" Problem
```
bc= Using remote management service (e.g. winrm, powershell) on a host without unconstrained delegation

## Background
C= bc
P = To identify that whether we have a Kerberos Double Hop problem or not.

## Workaround #1: PSCredential Object
C= Have Kerberos Double Hop problem
P=To bypass the double hop problem so we can continue our journey.

## Workaround #2: Register PSSession Configuration
C= Have Kerberos Double Hop problem and using powershell shell for remote management.
P=To bypass the double hop problem so we can continue our journey.

Note: Using PSSession Configuration is also more convenient than PSCredential Object, but is the only option that evil Win-Rm can use.
```

#### Bleeding Edge Vulnerabilities
```
bc=Have access to ad.
As an extra note, these attacks are likely to be out of scope for CPTS exams, as they are covered in extreme depth in other modules.
They would gnenerally be some of the last things to try in the exam

## NoPac (SamAccountName Spoofing)
- C=bc, valid ad domain user credentials
- P=Potential domain compromise. 

## PrintNightmare
- C=bc, valid ad domain user credential
- P=Potential domain compromise

## PetitPotam (MS-EFSRPC)
- C=bc
- P=Potential domain compromise

// Questions
Which two CVEs indicate NoPac.py may work? (Format: ####-#####&####-#####, no spaces)
	-> Illustrates the CVE number for NoPac

Apply what was taught in this section to gain a shell on DC01. Submit the contents of flag.txt located in the DailyTasks directory on the Administrator's desktop.
	-> Illustrates how domain compromise can be relatively easy obtained if the AD is vulnerable to any of these mentioned vulnerability. 
```

#### Miscellaneous Misconfigurations
```
bc= Gain foothold in AD

Note: This section has many stuff that are covered but not in great depth, be sure if exam has related thing to research the relevant section.

Exchange Related Group Membership / PrivExchange / Printer Bug / MS14-068 / Sniffing LDAP Credentials / Enumerating DNS Records / Other Misconfigurations / PASSWD_NOTREQD Field / Credentials in SMB Shares and SYSVOL Scripts / Group Policy Preferences (GPP) Passwords

C=bc
P=Potential to abuse various misconfiguration, which may allows us to gain useful info to further our access


ASREPRoasting
C=bc
P=Potential to obtain the hash and crack it for user credential, which may further our access.

Group Policy Object (GPO) Abuse
C=bc
P=Potential to abuse GPO objects, which may further our access.
- Note: GPO abuse will be covered in-depth in different modules. 
- Common in-depth modules that will be useful includes:
	- DACL attacks
	- Active Directory Certificate Services (AD CS) attacks
	- Kerberos attack:
		- Kerberos Constrained Delegation
		- Kerberos Unconstrained Delegation
		- Kerberos Resource-Based Constrained Delegation (RBCD)

// Questions
Find another user with the passwd_notreqd field set. Submit the samaccountname as your answer. The samaccountname starts with the letter "y".
	-> Illustrate how we can hunt for users with passwd_notreqd field set, and it's likely to have a weaker password for us to target.

Find another user with the "Do not require Kerberos pre-authentication setting" enabled. Perform an ASREPRoasting attack against this user, crack the hash, and submit their cleartext password as your answer.
	-> Illustrate how we can look for users with Kerberos pre-authentication not requried and perform ASREPRoast attack and gain its credentials. This may be an easy foothold!
```

## Why So Trusting? (Trust enumeration and attacks)
#### Domain Trusts Primer
```
bc= Gain foothold in AD

Domain Trusts Overview
- Overview on trusts:
	- Trusted domain can access other domain that trusted it
	- Trusts follow transitive relationship.

## Enumerating Trust Relationships
- C=bc
- P=Enumerate trust relationship (if any) to obtain trust relatioship which assist in planning out future attacks.

// Questions
What is the child domain of INLANEFREIGHT.LOCAL? (format: FQDN, i.e., DEV.ACME.LOCAL)
	-> Illustrates how find out child domains through enumeration on trust relationship.

What domain does the INLANEFREIGHT.LOCAL domain have a forest transitive trust with?
	-> Illustrates a forest transitive trust between domain.

What direction is this trust?
	-> Combined with the previous question, illustrates how both forest trust each other transitively and in a bidirectional manner, which helps us plan out future attacks. 
```

#### Attacking Domain Trusts - Child -> Parent Trusts - from Windows
```
bc=Domain compromised for child domain, on a windows host for the attack

## ExtraSids Attack - Mimikatz /
## ExtraSids Attack - Rubeus
C=bc
P=Parent domain compromise.


// Questions
What is the SID of the child domain?
	-> Laying out the work to compromise the parent domain, first by getting SID of child domain

What is the SID of the Enterprise Admins group in the root domain?
	-> Combined with the previous question, continuning our steps to comrpormise the parent domain. 

Perform the ExtraSids attack to compromise the parent domain. Submit the contents of the flag.txt file located in the c:\ExtraSids folder on the ACADEMY-EA-DC01.INLANEFREIGHT.LOCAL domain controller in the parent domain.
		-> Combined with the previous questions and with the the hash from the KRBTGT account, illustrates how we can perform the extrasids attack and comrpomise the parent domain. 
```

#### Attacking Domain Trusts - Child -> Parent Trusts - from Linux
```
bc=Domain compromised for child domain, on a Linux host for the attack

C=bc
P=Parent domain compromise

// Questions
Perform the ExtraSids attack to compromise the parent domain from the Linux attack host. After compromising the parent domain obtain the NTLM hash for the Domain Admin user bross. Submit this hash as your answer
	-> It is just like the windows domain, but illustrated how we can also do this on Linux. 
```

## Breaking Down Boundaries (Cross-Forest trust attack)

#### Attacking Domain Trusts - Cross-Forest Trust Abuse - from Linux
```
bc=Performing attack on Windows machine, there is a cross-forest trust, access to ad.

## Cross-Forest Kerberoasting
- c=bc, for Kerberos attack need valid domain user credentials
- P=Potential to gain credentials for privilege accounts across to further our access or used to land a foothold in AD. 

## Admin Password Re-Use & Group Membership
- C=bc
- P=Potential for quick wins for cross-forest domain compromise.

// Questions
Perform a cross-forest Kerberoast attack and obtain the TGS for the mssqlsvc user. Crack the ticket and submit the account's cleartext password as your answer.
	-> Illustrate how we can perform Kerberoast attack to obtain credentials for a privileged service account to further our access. 
```
#### Attacking Domain Trusts - Cross-Forest Trust Abuse - from Linux
```
bc= Performing attack on Linux machine, there is a cross-forest trust, access to ad

## Cross-Forest Kerberoasting
- c=bc, for Kerberos attack need valid domain user credentials
- P=Potential to gain credentials for privilege accounts across to further our access or used to land a foothold in AD.

## Hunting Foreign Group Membership with Bloodhound-python
C= bc, we have compromised some user from different forest. 
P= Quick wins for cross-forst domain compromise

// Questions
Kerberoast across the forest trust from the Linux attack host. Submit the name of another account with an SPN aside from MSSQLsvc.
	-> Illustration of performing cross-forest Kerberoast attack by first consulting the users available for Kerberoast

Crack the TGS and submit the cleartext password as your answer.
	-> The actual step of cracking the password for the service account.

Log in to the ACADEMY-EA-DC03.FREIGHTLOGISTICS.LOCAL Domain Controller using the Domain Admin account password submitted for question #2 and submit the contents of the flag.txt file on the Administrator desktop.
	-> Combining the previous questions, illustrated that through cross-forest Kerberoast and group membership (e.g. through bloodhound analysis), we were able to take control of the forest domain for full compromise. 
```

## Skills

#### AD Enumeration & Attacks - Skills Assessment Part I
```
Scenario

A team member started an External Penetration Test and was moved to another urgent project before they could finish. The team member was able to find and exploit a file upload vulnerability after performing recon of the externally-facing web server. Before switching projects, our teammate left a password-protected web shell (with the credentials: `admin:My_W3bsH3ll_P@ssw0rd!`) in place for us to start from in the `/uploads` directory. As part of this assessment, our client, Inlanefreight, has authorized us to see how far we can take our foothold and is interested to see what types of high-risk issues exist within the AD environment. Leverage the web shell to gain an initial foothold in the internal network. Enumerate the Active Directory environment looking for flaws and misconfigurations to move laterally and ultimately achieve domain compromise.

Apply what you learned in this module to compromise the domain and answer the questions below to complete part I of the skills assessment.
	-> Illustrated how to enumerate or attack AD, you must first compromise the web aspect first (e.g. nt authority on windows domain-joined account in this case)

Submit the contents of the flag.txt file on the administrator Desktop of the web server
	-> Getting started!

Kerberoast an account with the SPN MSSQLSvc/SQL01.inlanefreight.local:1433 and submit the account name as your answer:
	-> Through enumeration, we would find a high target value for Kerberoast, that is MSSQLSvc,SQL01, so an Kerberoast attempt would be on it. Illustrates how when we perform Kerberoast attack, we want to do it on high target value (sql service account in this case. )

Crack the account's password. Submit the cleartext value.
	-> Illustrate a successful Kerberoast attack, and the reward is huge, now we have local admin access. 

Submit the contents of the flag.txt file on the Administrator desktop on MS01
	-> Illustrated how an sql admin user is often an local admin! This is shown in the access of the sql admin. Furthermore, this access also sets us up for other attacks, such as local password attacks on the server in attempt to harvest credentials.

Find cleartext credentials for another domain user. Submit the username as your answer.
Submit this user's cleartext password.
	-> Illustrated local password attack (dump SAM and LSA) due to local admin privielge, causing another user's credentials to be leaked out

What attack can this user perform?
	-> This user turned out to have Dcsync privilege, the domain is effectively compromised.

Take over the domain and submit the contents of the flag.txt file on the Administrator Desktop on DC01
	-> Illustration of the power of Dcsync. 
```

#### AD Enumeration & Attacks - Skills Assessment Part II
```
## Scenario

Our client Inlanefreight has contracted us again to perform a full-scope internal penetration test. The client is looking to find and remediate as many flaws as possible before going through a merger & acquisition process. The new CISO is particularly worried about more nuanced AD security flaws that may have gone unnoticed during previous penetration tests. The client is not concerned about stealth/evasive tactics and has also provided us with a Parrot Linux VM within the internal network to get the best possible coverage of all angles of the network and the Active Directory environment. Connect to the internal attack host via SSH (you can also connect to it using `xfreerdp` as shown in the beginning of this module) and begin looking for a foothold into the domain. Once you have a foothold, enumerate the domain and look for flaws that can be utilized to move laterally, escalate privileges, and achieve domain compromise.

Apply what you learned in this module to compromise the domain and answer the questions below to complete part II of the skills assessment.
	-> Illustrates an penetration test, where the client provided us an VM to work on.


Skills
Obtain a password hash for a domain user account that can be leveraged to gain a foothold in the domain. What is the account name?
	-> Illustraed the power of LMNR poisoning.
	
What is this user's cleartext password?
	-> Illustrated that if NTLMv2 hash can be cracked, then a foothold is obtained.

Submit the contents of the C:\flag.txt file on MS01.
	-> Through RDP service, we were able to login to MS01 and start enumerating using PowerView as well. Illustrated that sometimes access to RDP is always uncertain (with a foothold, it is hard to determine local admin privilege for a specific computer, because it is managed "locally"). The best thing we can do is try and access it with the user we get, then go on from there. 

Use a common method to obtain weak credentials for another user. Submit the username for the user whose credentials you obtain.
	-> Illustrates the iterative nature of enumeration and the subtle differences between Inveigh and Responder- Inveigh handles spoofing on more service so we should always run them. 
	or
	-> We could use password spraying to obtain the credentials of another user!

What is this user's password?
	-> After cracking the question from the previous question, we would have obtained a pair of new credentials. 
		-> If enumerate this user, it is an IT manager, so it is likely to have access to credentials we previously couldn't (i.e. through shares). 
		->IT manager would likely have access to sensitive information

Locate a configuration file containing an MSSQL connection string. What is the password for the user listed in this file?
	-> Again, illustarting that enumeration is an iterative process, and using snaffler again to read files previously couln't read, and obtained the credentials for database admin (netdb)

Submit the contents of the flag.txt file on the Administrator Desktop on the SQL01 host.
	-> Once we logged in to the SQL server, we had limited rights, however we were able to perform privilege escalation through permission set, reaching to root. This allows us password attack the user and obtain the password hash for the privielged service user mssqlvc.
	-> Through our previous enumeration (while landing on the foothold on the windows machine), we were able to determine that the local admin for MS01 consists of Tier II Server admins, so now we have obtained local admin access. 

Obtain credentials for a user who has GenericAll rights over the Domain Admins group. What's this user's account name?
	-> Illustration of how local password attack doesn't always work, as in the case here. We obtained local admin access but local password attacks provided no extra info!
	-> In this case, we went back with iterative enumeration of Inveigh (which I think should be done first as an iterative process) and got the hash for the user

Crack this user's password hash and submit the cleartext password as your answer.
	-> Now, we were able to crack the NTLMv2 hash, which we have effectively compromised the domain.

Submit the contents of the flag.txt file on the Administrator desktop on the DC01 host.
	-> Through ACL attakcks (e.g. adding itself to domain admin), we could compromise the domain. 

Submit the NTLM hash for the KRBTGT account for the target domain after achieving domain compromise.
	-> Illustration how domain admin is not the end, as we could get the hash of KRBTGT account for future attacks (extra-sids for parent-child domain as well as persisitence).
```