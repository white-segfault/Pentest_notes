## FTP
Attacking FTP
```
basic Condition (bc):
- service = ftp + enumeration has been done carefully (modules 1-7 exectuted beforehand) + AD pwd policy ok for brute force related attacks

- Enumeration
	- C=have ftp service running
	- P=obtain ore information about the FTP service running for further attacks
	
- Misconfiguration
	- Anonymous Authentication
		- C=bc
		- P=obtain useful info
		
- Protocol Specifics Attacks
	- Brute force
		- C=bc, valid username for brute force, bc or 
			valid username list and passwordlist obtained previously. 
		- P=Gain further access/obtain useful info
	- FTP Bounce Attack
		- C=bc, valid internal IP addr to scan
		- P=Obtain useful info.

Skills Questions and illustration
- What port is the FTP service running on?
	-> FTP port can run on nonstandard ports
- What username is available for the FTP server?
	-> Username and password list can be obtained through previous means of enumeration.
- Use the discovered username with its password to login via SSH and obtain the flag.txt file. Submit the contents as your answer.
	-> Information we get from ftp can help us further our access.  
```

## SMB
#### Attacking SMB
```
Basic Condition (bc):
- service = smb + enumeration has been done carefully (modules 1-7 exectuted beforehand) + AD pwd policy ok for brute force related attacks

## Enumeration
	- C=Have smb service running
	- P=Obain more info about the SMB service running for further attacks
	
## Misconfiguration
	- Anonymous Authentication
		- C=bc
		- P:Obtain useful info
		
		
## Protocol Specifics Attacks
	- Brute Forcing and Password Spray
		- C=bc, valid username,passwordlist
		- P=Gain further access/obtain useful info
	- RCE/Dump hashes, enumeration... and more
		- c=bc, localadmin username + password
		- P=RCE, obtain useful info and more
	- Forced authentication attacks
		- c=bc, not sure, will skip for now.



Skills Questions and illustration
What is the name of the shared folder with READ permissions?
	-> Reading shares through SMB null session
What is the password for the username "jason"?
	-> Brute force attack can be achieved on smb if bc and have valid username and password list. ```shell-session
 -Pn -sV -sC -p1433 10.10.10.125
 Login as the user "jason" via SSH and find the flag.txt file. Submit the contents as your answer.
	-> SMB share can contain use info which furthers our access
```

## SQL
#### Attacking SQL Databases
```
bc: Have access to target, has SQL service running

Other note:
- Authentication thing:
- 

## Enumeration
C= bc
P= Enumerate information about the SQL service

## Protocol Specific Attacks
C= bc, have SQL credentials
P= Gain useful info

## Execute Commands
C= bc, xp_cmdshell needs to be enabled (usually require sysadmin)
P= To execute commands on the database server

## Write Local Files
C= bc, 'secure_file_priv' needs to be enabled for mysql or 'Ole Automation Procedures' needs to be enabled for mssql
P= Allows techniques such as writing webshell/reverse shell.

## Read Local Files
C= bc, account has privilege to read the file (for MSSQL) or "correct setting in place with privilege" for mysql
P= Obtain useful info through reading local files

## Capture MSSQL Service Hash
C=bc, have access to MSSQL
P= Allows us to obtain ntlmv2 hash from the MSSQL service account, which could be cracked for further access

Impersonate Existing Users with MSSQL
C= bc
p= Privilege escalation through impersonation

Communicate with Other Databases with MSSQL
C= bc
p= Increase of attack surface (other users may be impersonated as sysadmin) 


Skills Questions and illustrations:

Authenticate to with user "htbdbuser" and password "MSSQLAccess01!"
	-> need a valid pair of user and password credentials for the SQL service

What is the password for the "mssqlsvc" user?
	-> Illustrate how a normal user with database access can steal the hash of the mssql service hash
	
Enumerate the "flagDB" database and submit a flag as your answer.
	-> Illustrated how our user with limited privilege couldn't access flagDB, but with mssql service account we can, which furthes our access.
```

##  RDP
#### Attacking RDP
```
Basic Condition (bc):
- service = RDP + enumeration has been done carefully (modules 1-7 exectuted beforehand) + AD pwd policy ok for brute force related attacks

## Enumercation
C= Have rdp service open
P= Gaining more information about the RDP service for further attacks

## Misconfigurations
C= Have rdp service open, username list
P= To gain rdp credentials of users

## Protocol Specific Attacks
C= System level access, have other users active session on the laptop, not windows version 2019
P= To perform lateral movement/increase in attack surface.

## RDP Pass-the-Hash (PtH)
C= bc, valid pair of crdential for rdp log in
p= Access RDP service for the user (bringing different view/attack surface view of the target)

// Skills
RDP to 10.129.203.13 with user "htb-rdp" and password "HTBRocks!"
	-> Illustrating to enable PtH, need an valid pair of rdp credential
	
What is the name of the file that was left on the Desktop? (Format example: filename.txt)
	-> Illustrate how sometimes GUI access may be beneficial as it would be easier to look for helpful file like this.

Connect via RDP with the Administrator account and submit the flag.txt as you answer.
	-> Illusrate how admin can now connect to the desktop with GUI access.
```

## Dns

#### Attacking DNS
```
bc
- Have a name server to interact with (e.g. port 53 open)

## Enumeration
P= Have dns service open
C= Gaining information about the dns service running for further attacks

## DNS Zone Transfer
P= bc
C= Increase in attack surface/lateral movement on website

## Domain Takeovers & Subdomain Enumeration
P= bc
C= Increase in attack surface/lateral movement on website

DNS spoofing
- Skipped.

//Skills

Find all available DNS records for the "inlanefreight.htb" domain on the target name server and submit the flag found as a DNS record as the answer.
	-> Showcased how brute force dns record for subdomain and can be combined with zone transfer on some weird cases (didn't allow inlanefreight.htb but allowed hr.inlanefreight.htb)
```

## SMTP

#### Attacking Email Services
```
bc=Have smtp/imap/pop3 mail services running, AD pwd policy ok for brute force related attacks

## Enumeration
C= bc
P= To gain more information about mail services running for further attacks

## Misconfiguration
C= bc, have valid userlist to enumerate
P= To gain more information about users of mail services/domain for further attacks

## Cloud enumeration 
C= bc
P= To gain more information about users of mail services for further attacks (e.g. what cloud service emails they are using)

## Password Attacks
- C=bc, valid username list or passwordlist (typically obtained from misconfiguration) or from previous enumeration
- p=To obtain credentials for the user for further access of the network (e.g. with skills assessment, gained access to user email which could potentially gain useful information) 

Open-relay
C= bc
p= To send spam emails.  

//Skills
What is the available username for the domain inlanefreight.htb in the SMTP server?
	-> Illustrates how misconfiguration of mail server can cause unintended disclosure of username.
	
Access the email account using the user credentials that you discovered and submit the flag in the email as your answer.
	-> Chaining the previous misconfiguration obtained with password attack to gain access to the email of an employee (which might have useful info for attackers).
```

Skills assessment

Skills easy
```
Skills assessment 1 demonstrated an attack chain:

From the inital enumeration, the only attempt of attack was attacking the mail service (smtp enumeration) through the smtp service.

Through this misconfiguration, we found out an user fiona and attacked it through ftp brute force attack, which we obtained the credentials of the user fiona:987654321.

Through this credential obtained, 
	- we were able to login to the ftp, and obtained us some important information, particularly the webroot of the website.
	- We also were able to login to the mysql server (bc met) and noticed that we had file read/write privileges.

Thus, we were able to write the reverse shell onto the webroot and access it, finishing of the attack.

This is an illustration of how various attacks are able to be chained together. 

Short version:
SMTP misconfiguration (exposure of username) -> ftp attack (weak password) -> RDP service weakness (exposure of websroot) -> SQL attack (write permission)
```

Skills medium
```
Demonstrated the following attack chain:
dedicated nmap scan -> dns misconfiguration of zone transfer -> exposed the existence of an internal ftp service -> attack on internal ftp server -> obtain creds -> attack on outer ftp service -> obtain flag.

This skills assessment also showed the dangers of dns allowing zone transfer, exposing unintended information, as well as ftp misconfiguration.

Short version:
DNS misconfiguration (allows zone transfer) -> FTP server misconfiguration (allows anonymous login) -> Another FTP attack (vulnerable to brute force by left-behind password list)
```

Skills hard
```
Demonstrated the following attack chain
	-> SMB user authentication without password casued by SMB misconfiguration. 
	-> Resulting in leakage of credentials (username and password) that can be used on the SQL server, as well as information related to impersonation on linked server.
	-> Resulting in us being able to conduct an attack in the SQL server (impersonation on linked server) due to flaw in the SQL server.

What file can you retrieve that belongs to the user "simon"? (Format: filename.txt).
	-> Illustrates how the concept of SMB null session can be applied onto users (username without password). 


Enumerate the target and find a password for the user Fiona. What is her password?
	-> Illustrates how SMB null session can lead to disclosure of sensitive information.

Once logged in, what other user can we compromise to gain admin privileges?
	->Illustrate of impersonation attacks

Submit the contents of the flag.txt file on the Administrator Desktop.
	-> Illustrate the consequence of impersonation attack: Potential nt authority system RCE.

Short:
SMB misconfiguration (Allows user to login without password) -> Attack on SQL service(allows impersonation of user and on linked-server has sys privilege)
```