## Getting the Lay of the Land (Enumeration)
#### Situational Awareness
```cmd-session
bc= Access to a windows target

## Network Information
C= bc
P= To understand our surrounding and build situational awareness, sets up for future actions.


## Enumerating Protections
C= bc
P= To enumemrate protections on the pc, sets up for further actions evading it.

// Questions
-> Illustrate how we can obtain info such as IP address of another NIC attached to the target host and obtain what executable is blocked by AppLocker.
```

#### Initial Enumeration
```cmd-session
bc= Accessed to a windows target

## System Information
C= bc, performed situational awareness enumeration if necessary (for active directory environment)
P= To perform information gathering on system information and sets up for future attacks

## Questions
-> Illustrates how we can obtain a variety of useful info such as user privilege, group membership, user that are logged (with session type) and internal services running.
```

#### Communication with Processes
```cmd-session
bc= Access to a windows target


## Access Tokens
C= bc
P= Better understanding of ascess control in Windows.

## Enumerating Network Services
C= bc
P= Allows the enumeration of network services, sets up for future attacks.


## Named Pipes
C= bc
P= Enumeration of named pipes, sets up for attacks on named pipes

## Named Pipes Attack Example
C= bc
P= Example of attacking a named pipe for privesc

## Questions
-> Illustrates how we can enumerate useful network information and observe the DAC privileges of a named pipe.
```

## Windows User Privileges

#### Windows Privileges Overview
```powershell-session
bc= Access to a windows target

## Windows Authorization Process / ## Rights and Privileges in Windows/ ## User Rights Assignment / 

C= nothing
P= Better understanding of windows user privileges.

## Detection
C= bc or in a blue team creating plans to audit for user privileges
P= Better understanding of logging of windows user privileges.
```

SeImpersonate and SeAssignPrimaryToken
```shell-session
bc= Acess to a windows system

## SeImpersonate Example - JuicyPotato
C= bc
P= Identify whether the system is vulnerable to JuicyPotato and exploit is accordingly


## PrintSpoofer and RoguePotato
C= bc
P= Identify whether the system is vulnerable to printSpoofer or RoguePotato and exploit is accordingly


## Questions
-> Illustrates how we can perform privesc using the Juicy Potato
```

SeDebugPrivilege
```
bc= Access to windows target

## Overview / ## Remote Code Execution as SYSTEM
C= bc
P= Identify whether the user has SeDebugPrivilege and exploit it accordingly (dump hashes or RCE as system)

## Questions
-> Illustrate how we can useful ntlm hashes from accounts like sccm_svc through SeDebugPrivilege
```

#### SeTakeOwnershipPrivilege 
```powershell-session
bc= Access to windows target

## Leveraging the Privilege
C= bc
P= Identify whether the target has SeTakeOwnershipPrivilege and exploit it accordingly (e.g. on useful files)

## When to Use?
C= bc, have SeTakeOwnerShipPrivilege
P= Identify the type of files to use SeTakeOwnershipPrivilege on.

## Questions
-> Illustrate how we can identify and use SeTakeOwnershipPrivilege to access (e.g. read) files we don't originally have access to.
```

## Windows Group Privileges

#### Windows Built-in Groups
```
bc= Access to a windows target

## Backup Operators
C= bc
P= Identify whether our user belongs to an backup Operator group and exploit is accordingly (e.g. hash dumping, copying important files, copying NTDS.dit from domain controller).

## Robocopy
C= bc, user in Backup operators group
P= Use Robocopy to copy files

## Questions
-> Illustrates how we can copy important files using the backup operators group.
```

#### Event Log Readers
```
bc= Access to windows target

## Overview
C= bc
P= Identify whether the user is in the event log readers group and exploit it accoridngly

## Questions
-> Illustrates how we can read user credentials through being in the  event log reader and reading logs from it. 
```

#### DnsAdmins
```
bc= Access to windows target
	
## Leveraging DnsAdmins Access
C= bc
P= Identify whether the user belongs to the DNS admin group and exploit it accordingly

## Cleaning Up
C= bc, performed dns attack (## Levergaing DnsAdmins Access)
P= To clean up for our client.

## Using Mimilib.dll
C= bc
P= Alternative ways to attack through using the DNS admin group.

## Creating a WPAD Record
C= bc
P= To perform spoofing attacks (doesn't seem that much useful to me) if user belongs to DNS admin groups.

## Questions
-> Illustrate how we can abuse the DNS admins group for priesc, as well as how we need to relogin after performing such an attack to gain our elevated privilege.
```

#### Hyper-V Administrators
```
bc= Access to windows target.

## Overview
C= bc
P= To identify whether our user belongs to the Hyper-V Administrator group and exploit it accordingly.
```

#### Print Operators
```
bc= Have a windows target to access

## Overview
C= bc
P= To identify whether the user is in the Print operators group and exploit it for privesc accordingly.

## Alternate Exploitation - No GUI
C= bc, user in Print Operator, no GUI
P= To perform privesc on Print Operators where we do not have GUI access.

## Automating the Steps
C= bc, user in Print Operator
P= Allow automation of the above steps (enabling the privilege, creating reg key aand executing NTLoadDriver...)

## Questions
-> Illustrates how we can perform privesc to system through the Print Operators group.
```

#### Server Operators
```cmd-session
bc= Have a windows target to access

## Overview
C= bc
P= To identify whether our user is in the Server Operators group and exploit it accordingly.

## Questions
-> Illustrate how we can escalate our privileges to Local admin (even to local admin on domain controllers) with this user group.
```

## Attacking the OS

#### User Account Control
```
bc= Access to windows target

## Overview
C= bc
P= Identify whether there is UAC and bypass it,

## Questions
-> Illustrate how we can byass UAC given the OS version and build number.
```

#### Weak Permissions
```
bc= Have a windows target

## Permissive File System ACLs
C= bc
P= Identify whether there is a permissive File System AClLs and exploit it accordingly.

## Weak Service Permissions
C= bc
P= Identify whether there is a weak service permissions and exploit it accordingly

## Weak Service Permissions - Cleanup
C= bc, performed attack on weak service permissions
P= To clean up for clients.

## Unquoted Service Path
C= bc
P= To identify whether there is an unquoted service path and exploit it accordingly.

## Permissive Registry ACLs
C= bc
P= To identify whether there is an permissive registry ACLs and exploit it accordingly.

## Modifiable Registry Autorun Binary
C= bc
P= To identify whether there is an Modifiable Registry Autorun Binary and exploit it accordingly.

## Questions
-> Illustrate how we can identify and abuse permissive file system acl's and weak service permissions for privesc.
```

## Kernel Exploits
```
bc= Access to a windows target

## Notable Vulnerabilities
C= bc
P= To identify notable vulnerabilties (print spooler or hive nightmare) and exploit them accoringly for priesc

## Enumerating Missing Patches
C= bc
P= To identify how long ago the system patched its system, sets up future attacks (e.g. kernel related attacks).

## CVE-2020-0668 Example
C= bc, works best if the target is patched long time ago (e.g. March of 2021)
P= To identify whether the target is vulnerable to CVE-2020-0668 and exploit it accordingly.

## Questions
-> illustrate how we can identify and exploit the notable vulnerabilities and exploit them for system priesc.
```

#### Vulnerable Services
```
bc= Access to a windows target

## Overview
C= bc
P= To enumerate if there is any possible vulnerable service, sets up for future attacks (e.g. Druva inSync here)

## Druva inSync Windows Client Local Privilege Escalation Example
C= bc, identified some instance of vulnerable service (e.g. Druva inSync) 
P= To exploit the vulnerable service for privsec

## Questions
-> Illustrate how we can identify enumerate the vulnerable service then exploit it for privesc.
```

#### DLL Injection

```
## LoadLibrary / ## Reflective DLL Injection / DLL Hijacking
C= nothing
P= To give an overview of DLL injection methods at an high level
```

## Credential Theft

#### Credential Hunting
```
bc= Access to a windos target

## Application Configuration Files
C= bc
P= To identify whether the application has password/crdentials in config files

## Dictionary Files
C= bc
P= TO identify whether there are user passwords in Dictionary Files

## Unattended Installation Files
C= bc
P= To identify whether there are unattended.xml file with credentials we can look at.

## PowerShell History File
C= bc
P= To identify whether the PowerShell History file has useful info (e.g. crdentials) that we can read.

## PowerShell Credentials
C= bc, same user on the computer the encryption of credentials were created on
P= To identify whether there are Powershell credentials that can be reversed and reverse them to gain credentials.

## Exercise 
-> Illustrated how searching directory is important for searching related options (e.g. Application Configuration Files), starting from C:\ is the safest but will often have lots of file to look at.

	-> Starting at C:\users could lower this noise and search for more related info.
	-> Or we could go through the amount of data and look at the outut carefully (through piping to a file).

-> Also illustrated how we can reverse credentials, given that we are the same user on the same computer where the encryption was performed.
```

#### Other Files
```
bc= Access to Windows target

## Manually Searching the File System for Credentials
C= bc
P= To identify whether there are files with credentials and read them accordingly.


## Sticky Notes Passwords
C= bc
P= To identify whether there are sticky notes with passwords and read them accordingly.

## Other Files of Interest
C= bc
P= Other useful files we can look at during an engagement.

## Question
-> Illustrates how passwords can be stored in sticky notes and how we can read them.
	-> Also a reminder to myself how always try the same method twice, as sometimes there could be bugs or random errors during the first try. 
```

#### Further Credential Theft
```
bc= Access to Windows target

## Cmdkey Saved Credentials / ## Browser Credentials / ## Password Managers / ## Email / ## More Fun with Credentials / ## Even More Fun with Credentials / ## Clear-Text Password Storage in the Registry / ## Wifi

C= bc
P= Identify whether there are vulnerabilities in credential storage through the use of these tools are read the password accordingly.

## Questions
-> Illustrated how we can read the credentials for the users through the use of these tools if they are nt stored correctly.
```

## Restricted Environment
#### Citrix Breakout
```
bc= In an restricted environment

## Bypassing Path Restrictions
C= bc
P= To bypass path restrictions in restricted environment (e.g Citrix)

## Accessing SMB share from restricted environment
C= bc, bypassed Path restrictons
P= To achieve RCE under current user context

## Alternate Explorer
C= bc, bypassed Path restrictons
P= To copy files faster to the targed host or used as an alternative explorer.

## Alternate Registry Editors
C= bc, bypassed Path restrictons
P= Tools for registry editing, helps sets up for related attacks. 

## Modify existing shortcut file / ## Script Execution
C= bc
P= Other alternative ways to obtain rce under current user privilege

## Escalating Privileges
C= bc, obtained rce
P= Identify if we can perform priesc and do so accoringly.

## Bypassing UAC
C= bc, performed privesc to admin but have UAC 
P= To bypass UAC

## Questions
-> Illustrated how we can escape out of restricted environment and obtain system shell in a two step manner:
	1. Get RCE under current user context (through gaining access to dialog box)
	2. Perform Privesc
```

## Additional Techniques

#### interacting with Users
```
bc= Have a windows target to access
	
## Traffic Capture
C= bc
P= To assesses whether we an capture traffic and whether we can capture anything useful.

## Process Command Lines
C= bc
P= To assesses whether we can capture any useful info being passed to the command line.

## Vulnerable Services
C= bc
P= To identify whether there and vulnerable services and exploit them accordingly.

## SCF on a File Share
C= bc
P= To assesses whether the target is vulnerable to SCF and exploit it accordingly to gain NTLMV2 hashes and crack them.

## Capturing Hashes with a Malicious .lnk File
C= bc
P= To assesses whether the target is Malicious .lnkFile and exploit it accordingly to gain NTLMV2 hashes and crack them.

## Questions
-> Illustrates how the key to SCF on a FIle share and capturing Hashesh with a Malicious .lnk file is the placement of the file
```

## Additional Techniques

#### interacting with Users
```
bc= Access to a windows target

## Traffic Capture
C= bc
P= Assess if we can perform traffic Capture and do so accordingly to get useful info such as credentials.

## Process Command Lines
C= bc
P= Assess if we can perform command line monitoring to gain useful info such as crdentials

## Vulnerable Services
C= bc
P= Assess if there are any vulnerable services and exploit them accoringly for privesc

## SCF on a File Share
C= bc
P= Assess if there are any places where we can write to file shares and exploit them for responder type spoofing attack.  

## Capturing Hashes with a Malicious .lnk File
C= bc
P= Additional technique (for windows version 2019) to assess if there are any places where we can write to file shares and exploit them for responder type spoofing attack.

## Questions
-> Illustrates how we can gain the NTLMV2 hash of another potential privileged user (Configuration manager), crack the hash and obtain its password for lateral movement. 
```

#### Pillaging
```
bc= Access to a windows target

## Installed Applications
C= bc
P= Assess whether there are credentials we can extract throught the installed applications and use them for further access. 


## Abusing Cookies to Get Access to IM Clients
C= bc, user uses IM applications like Slack or Microsoft Teams.
P= Assess whether we can extract cookies from the current user. 

## Clipboard
C= bc
P= Assess whether there are credentials being copied throughout the clipboard and use it to furhter our access

## Roles and Services
C= bc
P= Assess the roles and services of the host and identify whether we can exploit it to furhter our access (e.g. access to backup server allows us to restore sensitive data).

## Questions
-> Illustrates how we can pillage credentials and form an attack chain, eventually leading us the access of backup host and recover the sensitive data (from mRemoteNG config file creds -> cred disclosure from slack -> final access to backups server -> we can restore hashes).
```

#### Miscellaneous Techniques

```
bc= Access to a windows target

## Living off the land techniques
C= bc, have action we want to perform but are limited in action.
P= To perform restricted action using living off the land binary.

## Always Install elevted
C= bc
P= To assess whether the system has always install elevate and exploit it for privesc accordingly.

## CVE-2019-1388
C= bc
P= To assess whether the target is vulnerable to CVE-2019-1388 and exploit it for privesc accordingly.

## Scheduled Tasks
C= bc
P= To assess whether the target has scheduled task with weak permissions and exploit it for privesc accordingly.

## User/Computer Description Field
C= bc
P= To assess whether the target has sensitive info (like password) in the user/computer description field and exploit it for further access.

## Mounting VHDX/VMDX
C= bc
P= To assess whether the target has VHDX/VMDX file file through the use of tools like Snaffler and gain credentials for further access.

## Questions
-> Illustrates how we can obtain the credentials of user through examining the User/Computer Description Field
```

#### Windows Server
```
bc= Access to a legacy windows system (like server 2008)

## Server 2008 Case Study
C= bc
P= To assess the legacy window system and exploit it for privesc accordingly.

## Questions
-> Illustrates how we can exploit an Server 2008 window system.
```

#### Windows Desktop Versions
```
bc= Access to a windows 7 target

## Windows 7 case study
C= bc
P= To assess the Windows 7 Desktop version target and exploit it for privesc accordingly.

## Questions
-> Illustrate how we can exploit and Windows 7 Desktop version target
```

## Closing thoughts
#### Windows Hardening
```
bc= Remidiation advice to harden windows system.

## Updates and Patching / ## Configuration Management / ## Audit / ## Logging  / ## Sysmon / ## Network and Host Logs / ## Key Hardening Measures / ## Conclusion

C= bc
P= To provide remidiation advice for windows hardening to the client.
```

#### Skills assessment 
```
-> Skills 1 illustrates the one of the things to look out for potato attacks: For different versions of windows, we will have to try different CLSID, that is the service to impersonate, followed by searching on credentials to compromise a machine. 

-> Skills 2 illustrates misconfiguraton (always install elevated) along with bad practices on password files. 
```
